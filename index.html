<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Ø¨ÙŠØªÙ†Ø§ Ø§Ù„Ø¬Ù…ÙŠÙ„</title>
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
<style>
:root {
    --bg-living: #FFEBEE;
    --bg-kitchen: #E0F7FA;
    --neo-black: #0d0d0d;
    --neo-white: #ffffff;
    --neo-pink: #FF4081;
    --neo-yellow: #FFEB3B;
    --neo-green: #00E676;
    --neo-blue: #2979FF;
    --neo-purple: #D500F9;
    --border: 3px solid var(--neo-black);
    --shadow: 4px 4px 0px rgba(0,0,0,0.8);
    --shadow-active: 2px 2px 0px rgba(0,0,0,0.8);
}
@font-face { font-family: 'NeoFont'; src: local('Impact'), local('Arial Black'), sans-serif; }
* { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
body {
    margin: 0; overflow: hidden; font-family: 'Tahoma', sans-serif;
    background: #1a1a1a; touch-action: none; user-select: none; color: var(--neo-black);
    direction: rtl;
}
.neo-box {
    background: var(--neo-white);
    border: var(--border);
    box-shadow: var(--shadow);
    border-radius: 12px;
    font-weight: bold;
}
.neo-btn {
    background: linear-gradient(135deg, var(--neo-yellow) 0%, #FBC02D 100%);
    border: var(--border);
    box-shadow: var(--shadow);
    border-radius: 12px;
    padding: 10px 15px;
    font-weight: bold;
    font-size: 18px;
    cursor: pointer;
    transition: all 0.1s cubic-bezier(0.4, 0, 0.2, 1);
    min-width: 44px; min-height: 44px;
    display: flex; align-items: center; justify-content: center;
    position: relative; overflow: hidden;
}
.neo-btn::after {
    content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%;
    background: rgba(255,255,255,0.2); opacity: 0; transition: opacity 0.2s;
}
.neo-btn:active {
    transform: translate(2px, 2px);
    box-shadow: var(--shadow-active);
    background: var(--neo-pink); color: white;
}
.neo-btn:active::after { opacity: 1; }

.modal-overlay {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    background: rgba(0,0,0,0.85); z-index: 2000; display: none;
    justify-content: center; align-items: center;
    backdrop-filter: blur(5px);
    animation: fadeIn 0.3s ease-out;
}
@keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

.modal-box {
    padding: 25px; text-align: center;
    max-width: 450px; width: 95%; max-height: 85vh; overflow-y: auto;
    background: var(--neo-white); border: 4px solid var(--neo-black);
    box-shadow: 10px 10px 0px var(--neo-black);
    border-radius: 16px;
    animation: popIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
}
@keyframes popIn { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }

.frost-theme .modal-box {
    background: linear-gradient(135deg, #E0F7FA 0%, #B2EBF2 100%);
    border: 4px solid #00ACC1;
    box-shadow: 0 0 15px #26C6DA, inset 0 0 20px rgba(255,255,255,0.8);
    position: relative;
    overflow: hidden;
}
.frost-theme .modal-box::before {
    content: 'â„ï¸'; position: absolute; top: 5px; left: 5px; font-size: 24px; opacity: 0.6; pointer-events: none;
}
.frost-theme .modal-box::after {
    content: ''; position: absolute; top: 0; left: 0; right: 0; bottom: 0;
    background: radial-gradient(circle, transparent 20%, rgba(255,255,255,0.4) 21%, transparent 22%) 0 0 / 20px 20px;
    opacity: 0.5; pointer-events: none;
}

#splash-screen {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    background: linear-gradient(180deg, #0f2027 0%, #203a43 50%, #2c5364 100%);
    z-index: 5000; display: flex; flex-direction: column; 
    align-items: center; justify-content: space-between;
    transition: opacity 0.5s; overflow: hidden;
}
.stars {
    position: absolute; top: 0; left: 0; width: 100%; height: 100%;
    background-image: radial-gradient(white 1px, transparent 1px);
    background-size: 50px 50px; opacity: 0.5; pointer-events: none;
}
.santa-wrapper {
    position: absolute; top: 15%; width: 100%; height: 60px; pointer-events: none;
}
.santa {
    position: absolute; font-size: 40px;
    animation: santaFly 8s linear infinite;
    filter: drop-shadow(0 0 10px rgba(255,255,255,0.5));
}
@keyframes santaFly {
    0% { transform: translateX(120vw) translateY(0) scaleX(1); }
    25% { transform: translateX(50vw) translateY(20px) scaleX(1); }
    50% { transform: translateX(-20vw) translateY(0) scaleX(1); }
    100% { transform: translateX(-20vw) translateY(0) scaleX(1); }
}
.snow-container {
    position: absolute; width: 100%; height: 100%; pointer-events: none;
}
.snowflake {
    position: absolute; color: white; opacity: 0.8;
    animation: fall linear infinite; top: -20px;
}
@keyframes fall { to { transform: translateY(110vh); } }

.splash-content {
    z-index: 10; display: flex; flex-direction: column; align-items: center;
    margin-top: 15vh;
}
.splash-title {
    font-family: 'NeoFont', sans-serif; font-size: 60px; color: var(--neo-yellow);
    text-shadow: 4px 4px 0px #000, 0 0 20px rgba(255,215,0,0.5); 
    margin-bottom: 20px; transform: rotate(-3deg);
    animation: floatTitle 3s ease-in-out infinite;
}
@keyframes floatTitle { 0%,100% { transform: rotate(-3deg) translateY(0); } 50% { transform: rotate(-3deg) translateY(-10px); } }

.scene {
    width: 100%; height: 200px; position: relative;
    display: flex; justify-content: center; align-items: flex-end;
    padding-bottom: 40px;
}
.ground-snow {
    position: absolute; bottom: 0; width: 100%; height: 60px;
    background: white; border-top: 4px solid #000;
    border-radius: 50% 50% 0 0 / 20px 20px 0 0;
}
.s-house {     font-size: 272px;
    z-index: 0;
    position: relative;
    bottom: -22px;
    filter: drop-shadow(4px 4px 0px rgba(0, 0, 0, 0.5));}
.s-tree { font-size: 80px; position: absolute; left: 50%; margin-left: -140px; bottom: 20px; z-index: 1; animation: treeShake 3s infinite; }
.s-bear-group { 
    position: absolute; right: 50%; margin-right: -150px; bottom: 20px; 
    display: flex; gap: 5px; z-index: 3; align-items: flex-end;
}
.s-bear { font-size: 90px; animation: bounce 2s infinite; position: relative; }
.s-chick { font-size: 50px; animation: bounce 2s infinite 0.2s; position: relative; }

.splash-bubble {
    position: absolute; bottom: 110px; right: 20px;
    background: var(--neo-white); color: var(--neo-black);
    padding: 8px 12px; border-radius: 12px; border: 2px solid var(--neo-black);
    font-size: 14px; white-space: nowrap; width: max-content;
    box-shadow: 2px 2px 0 rgba(0,0,0,0.3);
    z-index: 10; animation: floatTitle 2s ease-in-out infinite;
}
.splash-bubble::after {
    content: ''; position: absolute; top: 100%; right: 20px;
    border-width: 6px; border-style: solid; 
    border-color: var(--neo-white) transparent transparent transparent;
}
#splash-hearts-container {
    position: absolute; top: -40px; left: 0; width: 100%; height: 50px;
    pointer-events: none;
}
.splash-heart-anim {
    position: absolute; font-size: 20px; animation: floatUp 1.5s infinite linear;
}

@keyframes treeShake { 0%,100% { transform: rotate(0); } 25% { transform: rotate(5deg); } 75% { transform: rotate(-5deg); } }

#hud {
    position: fixed; top: 0; left: 0; width: 100%; height: 70px;
    z-index: 1000; display: flex; justify-content: space-between; align-items: center;
    padding: 5px 10px; background: rgba(255,255,255,0.95);
    border-bottom: var(--border); box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    backdrop-filter: blur(5px);
}
.hud-grp { display: flex; align-items: center; gap: 8px; height: 100%; }
.hud-stat {
    display: flex; flex-direction: column; align-items: center; justify-content: center;
    font-size: 12px; line-height: 1.1; font-weight: 900;
}
.bar-con {
    width: 80px; height: 14px; border: 2px solid var(--neo-black);
    background: #333; border-radius: 8px; overflow: hidden; position: relative;
    box-shadow: inset 0 2px 4px rgba(0,0,0,0.5);
}
.bar-fill { height: 100%; transition: width 0.3s cubic-bezier(0.4, 0, 0.2, 1); position: relative; }
.bar-fill::after {
    content: ''; position: absolute; top: 0; left: 0; right: 0; bottom: 0;
    background: linear-gradient(45deg, rgba(255,255,255,0.2) 25%, transparent 25%, transparent 50%, rgba(255,255,255,0.2) 50%, rgba(255,255,255,0.2) 75%, transparent 75%, transparent);
    background-size: 10px 10px;
}
#anger-fill { background: linear-gradient(90deg, #ff9a9e 0%, #ff6b6b 100%); }
#xp-fill { background: linear-gradient(90deg, #a18cd1 0%, #fbc2eb 100%); }

#world { 
    position: absolute; top: 70px; width: 100vw; height: calc(100vh - 70px); 
    display: flex; direction: ltr; overflow: hidden;
}
#zone-living {
    flex: 1; background-color: var(--bg-living); position: relative; border-right: var(--border);
    background-image: radial-gradient(#ffcdd2 2px, transparent 2px); background-size: 30px 30px;
}
#zone-kitchen {
    flex: 1; background-color: var(--bg-kitchen); position: relative;
    background-image: linear-gradient(45deg, #b2ebf2 25%, transparent 25%, transparent 75%, #b2ebf2 75%), linear-gradient(45deg, #b2ebf2 25%, transparent 25%, transparent 75%, #b2ebf2 75%);
    background-position: 0 0, 15px 15px; background-size: 30px 30px;
}

.obj {
    position: absolute; display: flex; flex-direction: column; align-items: center;
    font-size: 36px; cursor: pointer; z-index: 10;
    transition: transform 0.1s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    filter: drop-shadow(2px 4px 0px rgba(0,0,0,0.2));
}
.obj:active { transform: scale(0.9) rotate(5deg); filter: drop-shadow(1px 2px 0px rgba(0,0,0,0.2)); }
.obj-label {
    font-size: 10px; background: var(--neo-black); color: var(--neo-white);
    padding: 3px 8px; margin-top: -5px; pointer-events: none;
    font-weight: bold; border-radius: 10px; border: 1px solid white;
}
.prog-bar { 
    width: 44px; height: 10px; background: var(--neo-white); border: 2px solid var(--neo-black); 
    display: none; margin-bottom: 2px; position: relative; border-radius: 4px; overflow: hidden;
    z-index: 15;
}
.prog-fill { width: 0%; height: 100%; background: var(--neo-green); box-shadow: inset 0 -2px 0 rgba(0,0,0,0.2); }
.obj-img { width: 50px; height: 50px; object-fit: contain; pointer-events: none; }

#fridge { 
    left: 2%; top: 5%; width: 60px; height: 90px; 
    background: linear-gradient(135deg, #ffffff 0%, #cfd8dc 100%);
    border: 3px solid #455A64; border-radius: 8px; position: absolute;
    box-shadow: 4px 4px 0px rgba(0,0,0,0.2);
}
#fridge::before {
    content: ''; position: absolute; top: 30%; left: 0; width: 100%; height: 2px; background: #455A64;
}
.fridge-handle {
    position: absolute; right: 6px; width: 6px; background: #90A4AE; 
    border: 1px solid #455A64; border-radius: 3px; box-shadow: 1px 1px 0 rgba(0,0,0,0.2);
}

#stove { bottom: 8%; left: 2%; }
#stove2 { bottom: 8%; left: 18%; }
#oven { bottom: 8%; left: 34%; }
#oven2 { bottom: 8%; left: 50%; }
#prep { bottom: 25%; left: 2%; }
#prep2 { bottom: 25%; left: 18%; }
#sushi-maker { bottom: 25%; left: 34%; }
#sink { bottom: 8%; right: 2%; }
#plate-station { bottom: 25%; right: 2%; }

#fryer { top: 20%; right: 2%; }
#fryer2 { top: 35%; right: 2%; }
#icecream { top: 50%; right: 2%; }
#coffee-machine { top: 65%; right: 2%; }
#snacks-area { top: 80%; right: 2%; }
#cow-station { top: 5%; right: 15%; }

#stove, #oven, #prep, #fryer, #icecream, #coffee-machine, #snacks-area, #cow-station, #sink, #plate-station, #sushi-maker, #stove2, #prep2, #fryer2, #oven2 { 
    font-size: 32px; position: absolute;
}

#shower, #bed, #tv, #sofa, #chair, #kissing-bench { font-size: 40px; }
#dirty-plates { 
    position: absolute; top: -15px; right: -10px; 
    background: var(--neo-pink); color: white; 
    border: 2px solid black; width: 28px; height: 28px; border-radius: 50%;
    font-size: 14px; display: none; align-items: center; justify-content: center; z-index: 20;
    box-shadow: 2px 2px 0px rgba(0,0,0,0.3); animation: bounce 1s infinite;
}

#heba {
    position: absolute; width: 50px; height: 50px; font-size: 45px; z-index: 100;
    pointer-events: none; transition: top 0.3s linear, left 0.3s linear;
    display: flex; justify-content: center;
    filter: drop-shadow(0 4px 2px rgba(0,0,0,0.3));
}
#heba-stats {
    position: absolute; top: -30px; background: rgba(255,255,255,0.95);
    border: 2px solid black; border-radius: 12px; padding: 4px 10px;
    font-size: 12px; font-weight: bold; white-space: nowrap; display: flex; gap: 8px;
    box-shadow: 2px 2px 0px rgba(0,0,0,0.2);
}
#inventory-display { position: absolute; top: -65px; display: flex; gap: -5px; }
.inv-item-bubble { 
    font-size: 20px; background: var(--neo-white); padding: 5px; 
    border: 2px solid var(--neo-black); border-radius: 50%; 
    box-shadow: 2px 2px 0px rgba(0,0,0,0.2); z-index: 1;
}

#bear-container {
    position: absolute; width: 80px; height: 80px; z-index: 50;
    transition: top 1s ease, left 1s ease; cursor: pointer;
    filter: drop-shadow(0 5px 5px rgba(0,0,0,0.3));
}
#the-bear { font-size: 70px; text-align: center; position: absolute; bottom: 0; width: 100%; }
#orders-container {
    position: absolute; bottom: 95px; left: 50%; transform: translateX(-50%);
    display: flex; flex-direction: column; gap: 8px; align-items: center; z-index: 60;
}
#speech-bubble {
    position: absolute; bottom: 170px; left: 50%; transform: translateX(-50%);
    background: var(--neo-black); color: var(--neo-white); padding: 10px 16px;
    font-size: 15px; white-space: nowrap; pointer-events: none; opacity: 0; 
    transition: opacity 0.3s; z-index: 70; border-radius: 16px;
    box-shadow: 4px 4px 0px rgba(0,0,0,0.3); border: 2px solid white;
}
#speech-bubble::after {
    content: ''; position: absolute; top: 100%; left: 50%; margin-left: -8px;
    border-width: 8px; border-style: solid; border-color: var(--neo-black) transparent transparent transparent;
}
.order-bubble {
    background: var(--neo-white); border: 2px solid var(--neo-black); padding: 8px;
    min-width: 50px; text-align: center; box-shadow: 3px 3px 0px rgba(0,0,0,0.2);
    animation: pop 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    display: flex; gap: 8px; align-items: center; justify-content: center;
    border-radius: 12px;
}
.cooldown-circle {
    width: 16px; height: 16px; border-radius: 50%; background: conic-gradient(var(--neo-pink) 0%, #eee 0%);
    border: 2px solid var(--neo-black);
}

.rat { 
    position: absolute; font-size: 32px; transition: top 0.5s linear, left 0.5s linear; 
    z-index: 60; cursor: crosshair; filter: drop-shadow(2px 4px 2px rgba(0,0,0,0.4));
}
.dirt-obj {
    position: absolute; font-size: 28px; cursor: pointer; z-index: 5; opacity: 0.9;
    animation: pulse 2s infinite;
}
.kisses-effect {
    position: absolute; font-size: 36px; animation: floatUp 1.5s forwards; pointer-events: none; z-index: 80;
    text-shadow: 0 0 10px rgba(255,255,255,0.8);
}

#sleep-game, #kissing-game, #washing-game, #gift-modal, #drama-game {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    background: rgba(0,0,0,0.92); z-index: 4000; display: none; overflow: hidden;
    touch-action: none; flex-direction: column; align-items: center; justify-content: center;
}
#sleep-game { background: linear-gradient(135deg, #304FFE 0%, #1A237E 100%); z-index: 3000; justify-content: flex-start; }

#sleep-img {
    position: absolute; top: 0; left: 0; width: 100%; height: 100%;
    object-fit: cover; z-index: 10; cursor: pointer;
    transition: transform 0.05s;
}
#sleep-img:active { transform: scale(0.98); }
.shake { animation: shake 0.5s; }

#happiness-meter { 
    position: absolute; top: 40px; width: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 20;
}
#happy-text { color: var(--neo-yellow); font-family: 'NeoFont'; font-size: 28px; text-shadow: 3px 3px 0px var(--neo-black); margin-bottom: 8px; }
#happy-bar-container { width: 220px; height: 24px; background: #fff; border: 3px solid #000; border-radius: 12px; overflow: hidden; box-shadow: 4px 4px 0px rgba(0,0,0,0.3); }
#happy-bar-fill { height: 100%; width: 0%; background: linear-gradient(90deg, #F48FB1 0%, #F06292 100%); transition: width 0.1s linear; }

#washing-plate-container, #kissing-plate-container {
    position: relative; width: 300px; height: 300px; 
    background: radial-gradient(circle at 30% 30%, #fff, #f0f0f0); border-radius: 50%; display: flex; 
    align-items: center; justify-content: center;
    border: 8px solid #90A4AE; box-shadow: 0 0 50px rgba(255,255,255,0.1);
}
.wash-poop, .kiss-point {
    position: absolute; font-size: 45px; cursor: pointer;
    animation: bounce 1s infinite;
    filter: drop-shadow(2px 2px 0px rgba(0,0,0,0.2));
}

@keyframes pop { 0% { transform: scale(0); } 80% { transform: scale(1.1); } 100% { transform: scale(1); } }
@keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-15px); } }
@keyframes floatUp { 0% { transform: translateY(0) scale(1); opacity: 1; } 100% { transform: translateY(-60px) scale(1.5); opacity: 0; } }
@keyframes shake { 0% { transform: translate(1px, 1px); } 20% { transform: translate(-3px, 0); } 40% { transform: translate(1px, -1px); } 60% { transform: translate(-3px, 1px); } 80% { transform: translate(-1px, -1px); } 100% { transform: translate(0, 0); } }
@keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }

.grid-menu { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; margin: 15px 0; }
.menu-btn {
    background: linear-gradient(to bottom, #f0f0f0, #e0e0e0); border: 2px solid var(--neo-black); padding: 12px; font-size: 24px;
    box-shadow: 3px 3px 0px var(--neo-black); cursor: pointer; border-radius: 8px;
    transition: transform 0.1s;
}
.menu-btn:active { transform: translate(2px, 2px); box-shadow: 1px 1px 0px var(--neo-black); }

.hacker-btn { background: #ff0000; width: 20px; height: 20px; border-radius: 50%; border: 2px solid black; cursor: pointer; }
.shop-item { display: flex; flex-direction: column; align-items: center; border: 2px solid black; padding: 8px; border-radius: 12px; background: white; box-shadow: 3px 3px 0px rgba(0,0,0,0.1); position: relative; }
.shop-buy-btn { 
    background: var(--neo-green); color: white; border: none; padding: 6px; width: 100%; 
    cursor: pointer; margin-top: 5px; font-weight: bold; border-radius: 6px; 
    text-shadow: 1px 1px 0 rgba(0,0,0,0.2);
}
.shop-owned { background: #BDBDBD; cursor: default; }
.shop-nav { display: flex; justify-content: center; margin-top: 15px; gap: 10px; }
.tab-btn { background: #eee; border: 2px solid black; padding: 8px 16px; border-radius: 8px; cursor: pointer; font-weight: bold; }
.tab-btn.active { background: var(--neo-yellow); transform: translateY(-2px); box-shadow: 2px 2px 0 black; }
.shop-indicator { position: absolute; top: -5px; right: -5px; background: var(--neo-blue); color: white; border-radius: 50%; width: 20px; height: 20px; font-size: 12px; display: flex; align-items: center; justify-content: center; border: 1px solid black; }

#gift-box-anim {
    font-size: 100px; cursor: pointer; animation: bounce 2s infinite;
    filter: drop-shadow(0 0 20px gold);
    transition: transform 0.1s;
    user-select: none;
}
#gift-box-anim:active { transform: scale(0.9); }
.gift-text { color: white; font-family: 'NeoFont'; font-size: 24px; margin-top: 20px; text-align: center; }

@keyframes bounce-gift { 0% { transform: scale(1); } 50% { transform: scale(0.9); } 100% { transform: scale(1); } }
.gift-bounce { animation: bounce-gift 0.2s linear; }
.gift-float-text { 
    position: absolute; font-family: 'NeoFont'; font-size: 28px; 
    pointer-events: none; animation: floatUp 1s forwards; 
    text-shadow: 2px 2px 0 #000; font-weight: bold;
}
#gift-cont-btn { 
    display: none; margin-top: 20px; background: var(--neo-green); 
    color: white; width: 200px; font-size: 22px;
    animation: popIn 0.3s;
}

/* Drama & Sleep Mode Extras */
.tongue-anim {
    position: absolute; font-size: 60px; pointer-events: none;
    animation: fadeOutTongue 0.5s forwards; z-index: 100;
}
@keyframes fadeOutTongue { 0% { transform: scale(0.5) rotate(-10deg); opacity: 1; } 100% { transform: scale(1.2) rotate(10deg); opacity: 0; } }

.rain-drop {
    position: absolute; font-size: 30px; top: -50px;
    animation: rainFall 2s linear forwards; z-index: 3005;
}
@keyframes rainFall { to { transform: translateY(110vh); opacity: 0; } }

/* TELEGRAM STYLE DRAMA CHAT */
#drama-game {
    background: #0e1621;
    display: none;
    flex-direction: column;
    justify-content: center;
    align-items: center;
}

.drama-chat-box {
    width: 95%;
    max-width: 500px;
    background-image: linear-gradient(#0e1621 1px, transparent 1px), linear-gradient(90deg, #0e1621 1px, transparent 1px);
    background-size: 20px 20px;
    background-color: #17212b;
    border-radius: 12px;
    padding: 20px;
    display: flex;
    flex-direction: column;
    gap: 20px;
    max-height: 80vh;
    overflow-y: auto;
    border: 1px solid #2b5278;
}

.drama-row {
    display: flex;
    align-items: flex-end;
    gap: 10px;
    width: 100%;
}

.drama-row.left {
    justify-content: flex-start;
}

.drama-row.right {
    justify-content: flex-end;
}

.drama-avatar {
    font-size: 35px;
    min-width: 40px;
    text-align: center;
    filter: drop-shadow(2px 2px 2px rgba(0,0,0,0.5));
}

.drama-msg-bubble {
    padding: 10px 15px;
    border-radius: 16px;
    font-size: 18px;
    font-family: 'Tahoma', sans-serif;
    position: relative;
    max-width: 75%;
    box-shadow: 0 1px 2px rgba(0,0,0,0.3);
}

.drama-row.left .drama-msg-bubble {
    background-color: #182533;
    color: #ffffff;
    border-bottom-left-radius: 4px;
}

.drama-row.right .drama-choices-container {
    display: flex;
    flex-direction: column;
    gap: 8px;
    align-items: flex-end;
}

.drama-choice-btn {
    background-color: #2b5278;
    color: #ffffff;
    padding: 10px 20px;
    border-radius: 16px;
    border: none;
    font-size: 16px;
    cursor: pointer;
    text-align: left;
    transition: background 0.2s;
    font-weight: bold;
    box-shadow: 0 2px 2px rgba(0,0,0,0.2);
    border-bottom-right-radius: 4px;
}

.drama-choice-btn:active {
    background-color: #4682b4;
    transform: scale(0.98);
}

.drama-header {
    color: white;
    font-family: 'NeoFont';
    text-shadow: 0 0 10px #FF4081;
    margin-bottom: 20px;
}
</style>
</head>
<body>

<audio id="bg-music" loop src="https://assets.mixkit.co/music/preview/mixkit-sleepy-cat-135.mp3"></audio>
<audio id="sfx-click" src="https://assets.mixkit.co/active_storage/sfx/2578/2578-preview.mp3"></audio>
<audio id="sfx-pop" src="https://assets.mixkit.co/active_storage/sfx/2568/2568-preview.mp3"></audio>
<audio id="sfx-success" src="https://assets.mixkit.co/active_storage/sfx/2000/2000-preview.mp3"></audio>
<audio id="sfx-wash" src="https://assets.mixkit.co/active_storage/sfx/170/170-preview.mp3"></audio>
<audio id="sfx-kiss" src="https://assets.mixkit.co/active_storage/sfx/1429/1429-preview.mp3"></audio>
<audio id="sfx-cook" src="https://assets.mixkit.co/active_storage/sfx/181/181-preview.mp3"></audio>
<audio id="sfx-bear" src="https://assets.mixkit.co/active_storage/sfx/252/252-preview.mp3"></audio>
<audio id="sfx-modal" src="https://assets.mixkit.co/active_storage/sfx/2044/2044-preview.mp3"></audio>
<audio id="sfx-step" src="https://assets.mixkit.co/active_storage/sfx/2044/2044-preview.mp3"></audio>
<audio id="sfx-ding" src="https://assets.mixkit.co/active_storage/sfx/2000/2000-preview.mp3"></audio>
<audio id="sfx-fridge" src="https://assets.mixkit.co/active_storage/sfx/2568/2568-preview.mp3"></audio>
<audio id="sfx-fry" src="https://assets.mixkit.co/active_storage/sfx/181/181-preview.mp3"></audio>
<audio id="sfx-chop" src="https://assets.mixkit.co/active_storage/sfx/252/252-preview.mp3"></audio>
<audio id="sfx-water" src="https://assets.mixkit.co/active_storage/sfx/170/170-preview.mp3"></audio>
<audio id="sfx-tv" src="https://assets.mixkit.co/active_storage/sfx/2568/2568-preview.mp3"></audio>
<audio id="sfx-clean" src="https://assets.mixkit.co/active_storage/sfx/377/377-preview.mp3"></audio>
<audio id="sfx-shoot" src="https://assets.mixkit.co/active_storage/sfx/1666/1666-preview.mp3"></audio>
<audio id="sfx-ice" src="https://assets.mixkit.co/active_storage/sfx/1435/1435-preview.mp3"></audio>

<div id="splash-screen" onclick="Game.initSplash()">
    <div class="stars"></div>
    <div class="santa-wrapper">
        <div class="santa">ğŸ…ğŸ›·ğŸ¦Œ</div>
    </div>
    
    <div class="splash-content">
        <div class="splash-title">OUR HOUSE</div>
        <div class="neo-btn" style="font-size: 24px; padding: 15px 40px; animation: pulse 2s infinite; z-index: 20;">Ø§Ø¶ØºØ·ÙŠ Ø¹Ø´Ø§Ù† ØªØ¨Ø¯Ø£ÙŠ</div>
    </div>

    <div class="scene">
        <div class="s-tree">ğŸ„</div>
        <div class="s-house">ğŸ </div>
        <div class="s-bear-group">
            <div id="splash-bear-msg" class="splash-bubble"></div>
            <span class="s-bear">ğŸ§¸</span>
            <span class="s-chick">
                ğŸ¥
                <div id="splash-chick-hearts" id="splash-hearts-container"></div>
            </span>
        </div>
        <div class="ground-snow"></div>
    </div>
    
    <div class="snow-container" id="snow-container">
        <div class="snowflake" style="left: 10%; animation-duration: 5s; animation-delay: 0s;">â„</div>
        <div class="snowflake" style="left: 20%; animation-duration: 7s; animation-delay: 1s;">â…</div>
        <div class="snowflake" style="left: 30%; animation-duration: 4s; animation-delay: 2s;">â„</div>
        <div class="snowflake" style="left: 45%; animation-duration: 6s; animation-delay: 0.5s;">â†</div>
    </div>
</div>

<div id="hud">
    <div class="hud-grp" style="width: 150px;">
        <button class="neo-btn" onclick="Game.toggleShop()">ğŸ›’</button>
        <button class="neo-btn" onclick="Game.openRecipes()">ğŸ“–</button>
        <button class="neo-btn" onclick="Game.openInventory()">ğŸ’</button>
    </div>
    
    <div class="hud-grp" style="flex: 1; justify-content: center; background: linear-gradient(to bottom, #ffffff, #f5f5f5); border: 2px solid black; border-radius: 8px; padding: 0 10px; height: 50px; box-shadow: inset 0 2px 4px rgba(0,0,0,0.1);">
        <div class="hud-stat"><span>Ø­ÙŠØ§Ø©</span><span id="ui-lives" style="color:var(--neo-pink); font-size:16px;">ğŸ’›ğŸ’›ğŸ’›ğŸ’›</span></div>
        <div style="width:2px; height:20px; background:#ccc; margin:0 8px;"></div>
        <div class="hud-stat"><span>XP Ø¨Ø§Ù‚ÙŠ</span><span id="ui-xp-left" style="font-size:16px; color: var(--neo-purple);">0</span></div>
    </div>

    <div class="hud-grp" style="width: 90px; flex-direction: column; justify-content: center; align-items: flex-end; gap: 2px;">
        <div style="font-size:10px; font-weight:bold; color: var(--neo-pink);">Ø§Ù„Ø²Ø¹Ù„ ğŸ˜¡</div>
        <div class="bar-con"><div id="anger-fill" class="bar-fill" style="width:0%"></div></div>
        <div style="font-size:10px; font-weight:bold; color: var(--neo-purple);">Ø§Ù„Ø®Ø¨Ø±Ø© ğŸ†™</div>
        <div class="bar-con"><div id="xp-fill" class="bar-fill" style="width:0%"></div></div>
    </div>
</div>

<div id="start-modal" class="modal-overlay">
    <div class="modal-box">
        <h1 style="color:var(--neo-pink); text-shadow: 2px 2px 0px rgba(0,0,0,0.1);">Ø§Ø²ÙŠÙƒ ÙŠØ§Ø­ÙŠØ§ØªÙŠ ğŸ¥</h1>
        <p style="font-size:16px; line-height:1.6; background: #f9f9f9; padding: 10px; border-radius: 8px;">Ù¡.Ø§ÙƒÙ„ÙŠ Ø§Ù„Ø¯Ø¨Ø¨Ø¯ÙˆØ¨ Ùˆ Ø§Ù‚Ø¹Ø¯ÙŠ Ù…Ø¹Ø§Ù‡ ÙŠØ§ ÙƒØªÙƒÙˆØª<br>Ù¢. Ù…Ù…Ù†ÙˆØ¹ Ø§Ù„ØºÙ„Ø· (Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø§Øª Ù…Ø­Ø¯ÙˆØ¯)<br>Ù£. Ø¬Ù…Ø¹ÙŠ Ø®Ø¨Ø±Ø© Ø¹Ø´Ø§Ù† ØªØ®Ù„ØµÙŠ Ø§Ù„Ù…Ø³ØªÙˆÙ‰</p>
        <div id="start-info" style="margin: 10px 0; font-size: 14px; color: var(--neo-blue); font-weight: bold;"></div>
        <button class="neo-btn" style="width:100%; margin-top:15px; background:var(--neo-green);" onclick="Game.start()">ÙŠÙ„Ø§ Ù†Ø¨Ø¯Ø£</button>
    </div>
</div>

<div id="level-complete-modal" class="modal-overlay">
    <div class="modal-box">
        <h1 style="color:var(--neo-green); text-shadow: 2px 2px 0px rgba(0,0,0,0.1);">ğŸ‰ Ù…Ø¨Ø±ÙˆÙƒ ÙŠØ§ Ø´Ø·ÙˆØ±Ø©</h1>
        <div id="level-stats"></div>
        <button class="neo-btn" style="width:100%; margin-top:20px; background:var(--neo-blue); color:white;" onclick="GiftSystem.open()">Ø§ÙØªØ­ÙŠ Ø§Ù„Ù‡Ø¯ÙŠØ© ğŸ</button>
    </div>
</div>

<div id="game-over-modal" class="modal-overlay">
    <div class="modal-box" style="border-color: var(--neo-pink);">
        <h1 style="color:var(--neo-pink); text-shadow: 2px 2px 0px rgba(0,0,0,0.1);">Ø®Ø³Ø±ØªÙŠ ÙŠØ§ Ù‡Ø¨Ù„Ù‡ Ù‚Ù„Ø¨ÙŠ.... ğŸ˜‚</p>
        <button class="neo-btn" style="width:100%; background:var(--neo-yellow);" onclick="Game.restartLevel()">Ø¬Ø±Ø¨ÙŠ ØªØ§Ù†ÙŠ</button>
    </div>
</div>

<div id="generic-menu-modal" class="modal-overlay" onclick="if(event.target===this) Game.closeModals()">
    <div class="modal-box">
        <h2 id="menu-title" style="border-bottom: 2px solid #eee; padding-bottom: 10px;">Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©</h2>
        <div id="shop-tabs" class="shop-nav" style="display:none; margin-bottom:10px;"></div>
        <div class="grid-menu" id="menu-grid"></div>
        <div id="menu-footer"></div>
        <button class="neo-btn" style="width:100%; background:#e0e0e0; margin-top:10px;" onclick="Game.closeModals()">Ù‚ÙÙ„</button>
    </div>
</div>

<div id="hacker-modal" class="modal-overlay" onclick="if(event.target===this) Game.closeModals()">
    <div class="modal-box">
        <h2 style="color: red;">HACKER PANEL ğŸ’»</h2>
        <div id="hacker-stats" style="background:#000; color:#0f0; padding:10px; font-family:monospace; font-size:12px; text-align:left; margin-bottom:15px; border-radius:8px;"></div>
        
        <div style="margin-bottom:15px; border-bottom:1px solid #ccc; padding-bottom:10px;">
            <div style="font-weight:bold; margin-bottom:5px;">Level & Stats</div>
            <div style="display:flex; gap:5px; margin-bottom: 5px;">
                <select id="hack-lvl-sel" class="neo-btn" style="flex:1; background:white; font-size:14px;"></select>
                <button class="neo-btn" onclick="Game.setHackLevel()" style="background:var(--neo-blue); color:white;">Go</button>
            </div>
            <div style="display:flex; gap:5px; margin-bottom: 5px;">
                <input id="hack-xp-in" type="number" class="neo-btn" style="flex:1; background:white;" placeholder="XP">
                <button class="neo-btn" onclick="Game.setHackXP()" style="background:var(--neo-purple); color:white;">Set XP</button>
            </div>
             <div style="display:flex; gap:5px;">
                <input id="hack-anger-in" type="number" class="neo-btn" style="flex:1; background:white;" placeholder="Anger 0-100">
                <button class="neo-btn" onclick="Game.setHackAnger()" style="background:var(--neo-pink); color:white;">Set Anger</button>
            </div>
        </div>

        <div style="margin-bottom:15px; border-bottom:1px solid #ccc; padding-bottom:10px;">
            <div style="font-weight:bold; margin-bottom:5px;">Set Money</div>
            <div style="display:flex; gap:5px;">
                <input id="hack-cash-in" type="number" class="neo-btn" style="flex:1; background:white;" placeholder="$$$">
                <button class="neo-btn" onclick="Game.setHackCash()" style="background:var(--neo-green);">Set</button>
            </div>
        </div>
        
        <div style="margin-bottom:15px; border-bottom:1px solid #ccc; padding-bottom:10px;">
             <div style="font-weight:bold; margin-bottom:5px;">Execute Code</div>
             <textarea id="hack-eval" style="width:100%; height:60px; border:2px solid black; border-radius:8px;"></textarea>
             <button class="neo-btn" onclick="Game.runHackCode()" style="width:100%; margin-top:5px; background: black; color: white;">RUN</button>
        </div>

        <div class="grid-menu" style="grid-template-columns: 1fr 1fr;">
            <button class="menu-btn" onclick="Bear.addOrder('specific_food')">+ Food Demand</button>
            <button class="menu-btn" onclick="Bear.addOrder('quality_time')">+ Quality Demand</button>
            <button class="menu-btn" onclick="Bear.addOrder('kisses')">+ Kisses Demand</button>
            <button class="menu-btn" onclick="Game.winLevel()">Win Level</button>
            <button class="menu-btn" onclick="Game.gameOver()">Fail Level</button>
            <button class="menu-btn" onclick="Bear.anger=0; Bear.updateStats()">Calm Bear</button>
            <button class="menu-btn" onclick="Game.unlockAll()">Unlock All</button>
            <button class="menu-btn" onclick="Game.saveSettings()">Save Settings ğŸ’¾</button>
            <button class="menu-btn" onclick="Game.hardReset()" style="background:red; color:white;">Reset Game ğŸ—‘ï¸</button>
        </div>
        <button class="neo-btn" onclick="Game.closeModals()">Close</button>
    </div>
</div>

<div id="recipe-modal" class="modal-overlay" onclick="if(event.target===this) Game.closeModals()">
    <div class="modal-box">
        <h2>ÙƒØªØ§Ø¨ Ø§Ù„ÙˆØµÙØ§Øª ğŸ“–</h2>
        <div id="recipe-list" style="text-align:right; max-height:250px; overflow-y:auto; font-size:16px; line-height:2.2; padding: 10px; background: #f9f9f9; border-radius: 8px;"></div>
        <button class="neo-btn" style="width:100%; margin-top:15px; background:#e0e0e0;" onclick="Game.closeModals()">Ù‚ÙÙ„</button>
    </div>
</div>

<div id="inventory-modal" class="modal-overlay" onclick="if(event.target===this) Game.closeModals()">
    <div class="modal-box">
        <h2>Ø´Ù†Ø·ØªÙŠ ğŸ’</h2>
        <div id="inv-grid" class="grid-menu"></div>
        <button class="neo-btn" style="width:100%; margin-top:15px; background:#e0e0e0;" onclick="Game.closeModals()">Ù‚ÙÙ„</button>
    </div>
</div>

<div id="gift-modal">
    <div id="gift-box-anim" onclick="GiftSystem.click()">ğŸ</div>
    <div class="gift-text" id="gift-msg">Ø§Ø¶ØºØ·ÙŠ Ø¨Ø³Ø±Ø¹Ø© Ø¹Ø´Ø§Ù† ØªÙØªØ­ÙŠ!</div>
    <button id="gift-cont-btn" class="neo-btn" onclick="Game.nextLevel()">Level Up & Continue â©</button>
</div>

<div id="sleep-game">
    <div id="happiness-meter">
        <div id="happy-text">HAPPINESS <span id="happy-val">0</span></div>
        <div id="happy-bar-container"><div id="happy-bar-fill"></div></div>
    </div>
    <img id="sleep-img" src="" onclick="SleepGame.click(event)">
</div>

<div id="washing-game">
    <h1 style="color:white; font-family:'NeoFont'; text-shadow: 0 0 10px #29B6F6;">WASH THE DISHES!</h1>
    <div id="washing-plate-container"></div>
</div>

<div id="kissing-game">
    <h1 style="color:white; font-family:'NeoFont'; text-shadow: 0 0 10px #FF4081;">KISSING TIME!</h1>
    <div id="kissing-plate-container">
        <div style="font-size:80px; z-index: 1;">ğŸ»</div>
    </div>
</div>

<div id="drama-game">
    <h1 class="drama-header">DRAMA TIME! ğŸ­</h1>
    <div id="drama-chat-view" class="drama-chat-box"></div>
</div>

<div id="world" onclick="Player.move(event)">
    <div id="zone-living">
        <div id="bed" class="obj" style="left:2%; top:5%;" onclick="Interact.obj('bed', event)">
            <div class="prog-bar"><div class="prog-fill"></div></div><span class="vis">ğŸ›ï¸</span><div class="obj-label">ØªÙˆØ¶ÙŠØ¨</div>
        </div>
        <div id="tv" class="obj" style="right:2%; top:5%;" onclick="Interact.obj('tv', event)"><span class="vis">ğŸ“º</span><div class="obj-label">ØªÙ„ÙØ²ÙŠÙˆÙ†</div></div>
        <div id="sofa" class="obj" style="bottom:15%; left:50%; transform:translateX(-50%);" onclick="Interact.obj('sofa', event)"><span class="vis">ğŸ›‹ï¸</span></div>
        <div id="chair" class="obj" style="bottom:35%; left:5%;" onclick="Interact.obj('chair', event)"><span class="vis">ğŸ„</span><div class="obj-label">Ø±ØºÙŠ</div></div>
        <div id="kissing-bench" class="obj" style="bottom:50%; left:15%;" onclick="Interact.obj('kissing-bench', event)"><span class="vis">ğŸª‘ğŸª‘</span><div class="obj-label">kissing time</div></div>
        <div id="shower" class="obj" style="top:25%; left:2%;" onclick="Interact.obj('shower', event)">
             <div class="prog-bar"><div class="prog-fill"></div></div><span class="vis">ğŸš¿</span><div class="obj-label">Ø¯Ø´</div>
        </div>
    </div>
    <div id="zone-kitchen">
        <div id="fridge" class="obj" onclick="Interact.obj('fridge', event)">
            <div class="fridge-handle" style="top:20%; height:20px;"></div>
            <div class="fridge-handle" style="top:60%; height:30px;"></div>
        </div>
        <div id="stove" class="obj" onclick="Interact.obj('stove', event)">
            <div class="prog-bar"><div class="prog-fill"></div></div><span class="vis">ğŸ³</span>
        </div>
        <div id="stove2" class="obj" onclick="Interact.obj('stove2', event)">
            <div class="prog-bar"><div class="prog-fill"></div></div><span class="vis">ğŸ³</span>
        </div>
        <div id="oven" class="obj" onclick="Interact.obj('oven', event)">
            <div class="prog-bar"><div class="prog-fill"></div></div><span class="vis">ğŸ”¥</span>
        </div>
        <div id="oven2" class="obj" onclick="Interact.obj('oven2', event)">
            <div class="prog-bar"><div class="prog-fill"></div></div><span class="vis">ğŸ”¥</span>
        </div>
        <div id="prep" class="obj" onclick="Interact.obj('prep', event)">
            <div class="prog-bar"><div class="prog-fill"></div></div><span class="vis">ğŸ”ª</span>
        </div>
        <div id="prep2" class="obj" onclick="Interact.obj('prep2', event)">
            <div class="prog-bar"><div class="prog-fill"></div></div><span class="vis">ğŸ”ª</span>
        </div>
        <div id="fryer" class="obj" style="display:none;" onclick="Interact.obj('fryer', event)">
            <div class="prog-bar"><div class="prog-fill"></div></div><span class="vis">ğŸŸ</span>
        </div>
        <div id="fryer2" class="obj" style="display:none;" onclick="Interact.obj('fryer2', event)">
            <div class="prog-bar"><div class="prog-fill"></div></div><span class="vis">ğŸŸ</span>
        </div>
        <div id="icecream" class="obj" style="display:none;" onclick="Interact.obj('icecream', event)">
            <div class="prog-bar"><div class="prog-fill"></div></div><span class="vis">ğŸ¦</span>
        </div>
        <div id="coffee-machine" class="obj" style="display:none;" onclick="Interact.obj('coffee-machine', event)">
            <div class="prog-bar"><div class="prog-fill"></div></div><span class="vis">â˜•</span>
        </div>
        <div id="sushi-maker" class="obj" style="display:none;" onclick="Interact.obj('sushi-maker', event)">
            <div class="prog-bar"><div class="prog-fill"></div></div><span class="vis">ğŸ˜</span>
        </div>
        <div id="snacks-area" class="obj" style="display:none;" onclick="Interact.obj('snacks-area', event)"><span class="vis">ğŸ¿</span></div>
        <div id="cow-station" class="obj" style="display:none;" onclick="Interact.obj('cow-station', event)">
             <div class="prog-bar"><div class="prog-fill"></div></div><span class="vis">ğŸ„</span>
        </div>
        <div id="sink" class="obj" onclick="Interact.obj('sink', event)">
            <div class="prog-bar"><div class="prog-fill"></div></div><span class="vis">ğŸš°</span>
            <div id="dirty-plates">0</div>
        </div>
        <div id="plate-station" class="obj" onclick="Interact.obj('plate-station', event)"><span class="vis">ğŸ½ï¸</span></div>
    </div>

    <div id="bear-container" onclick="Interact.bear(event)">
        <div id="speech-bubble">Roar!</div>
        <div id="orders-container"></div>
        <div id="the-bear">ğŸ§¸</div>
    </div>
    
    <div id="heba">
        <div id="heba-stats">
            <span style="color:var(--neo-blue)">Lvl <span id="h-lvl">1</span></span>
            <span style="color:var(--neo-green)">$ <span id="h-cash">0</span></span>
        </div>
        <div id="inventory-display"></div>
        <span id="player-sprite">ğŸ¥</span>
    </div>
</div>

<script>
const TEXT = {
    flirts: [
        "ØªØ³Ù„Ù… Ø§ÙŠØ¯Ùƒ ÙŠØ§ Ø³Øª Ø§Ù„Ø¨Ù†Ø§Øª", "Ù‚Ù…Ø± ÙˆØ§Ù„Ù„Ù‡", "Ø§ÙŠÙ‡ Ø§Ù„Ø­Ù„Ø§ÙˆØ© Ø¯ÙŠ", "Ø±Ø¨Ù†Ø§ ÙŠØ®Ù„ÙŠÙƒÙŠ Ù„ÙŠØ§", "Ù†ÙØ³ÙŠ Ù…ÙØªÙˆØ­Ø© Ø¹Ø´Ø§Ù†Ùƒ",
        "ÙŠØ§ ÙˆØ¹Ø¯ÙŠ Ø¹Ù„Ù‰ Ø§Ù„Ø¬Ù…Ø§Ù„", "Ø§Ù†ØªÙŠ Ù…Ù„Ø¨Ø³Ø§ÙƒÙŠ Ø¹ÙØ±ÙŠØª Ø´Ø·Ø§Ø±Ø©ØŸ", "Ø§Ø­Ù„Ù‰ Ø§ÙƒÙ„ Ù…Ù† Ø§Ø­Ù„Ù‰ Ø§ÙŠØ¯", "ØªØ³Ù„Ù… Ù…Ø¬Ø§ÙŠØ¨Ùƒ ÙŠØ§ ØºØ§Ù„ÙŠØ©",
        "ÙŠØ®Ø±Ø¨ÙŠØª Ø·Ø¹Ø§Ù…ØªÙƒ", "ÙƒØ¯Ø§ ÙƒØªÙŠØ± Ø¹Ù„Ù‰ Ù‚Ù„Ø¨ÙŠ", "Ø¯Ù„Ø¹ÙŠÙ†ÙŠ ÙƒÙ…Ø§Ù† ÙˆÙƒÙ…Ø§Ù†", "Ø³Øª Ø§Ù„ÙƒÙ„ ÙˆØ¨Ø³", "Ø§Ù†ØªÙŠ Ø±Ø²Ù‚ ÙˆØ§Ù„Ù„Ù‡",
        "Ø§ÙŠÙ‡ Ø§Ù„Ø·Ø¹Ø§Ù…Ø© Ø¯ÙŠ ÙƒÙ„Ù‡Ø§", "ÙŠØ§ Ø¨Ø®ØªÙŠ Ø¨ÙŠÙƒÙŠ", "Ù…Ù†ÙˆØ±Ø© Ø­ÙŠØ§ØªÙŠ ÙˆØ§Ù„Ù…Ø·Ø¨Ø®", "Ø¹Ø³Ù„ ÙŠØ§ Ø®ÙˆØ§ØªÙŠ", "Ù‚Ù„Ø¨ÙŠ ÙŠØ§ Ù†Ø§Ø³",
        "Ù…ÙÙŠØ´ Ù…Ù†Ùƒ Ø§ØªÙ†ÙŠÙ†", "Ø­Ù„Ø§ÙˆØªÙƒ Ø²Ø§ÙŠØ¯Ø© Ø§Ù„Ù†Ù‡Ø§Ø±Ø¯Ø©", "ÙƒÙ„ÙŠ Ø§Ù†ØªÙŠ ÙŠØ§ Ù‚Ù„Ø¨ÙŠ", "Ù…Ø´ Ø¹Ø§ÙŠØ² ØºÙŠØ±Ùƒ", "Ù†Ø¹Ù… Ø§Ù„Ø²ÙˆØ¬Ø© Ø§Ù„ØµØ§Ù„Ø­Ø©",
        "ÙŠØ§ Ø³ÙŠØ¯ÙŠ ÙŠØ§ Ø³ÙŠØ¯ÙŠ", "Ù…Ù†ÙˆØ±Ø© Ø§Ù„Ø¯Ù†ÙŠØ§ ÙƒÙ„Ù‡Ø§", "Ø§ÙƒÙ„ Ù…Ù„ÙˆÙƒ Ø¯Ù‡", "ÙŠØ§ Ø¬Ù…Ø§Ù„Ùˆ ÙŠØ§ Ø¬Ù…Ø§Ù„Ùˆ", "Ø§ÙŠÙ‡ Ø§Ù„Ø¹Ø¸Ù…Ø© Ø¯ÙŠ",
        "Ù…Ù„ÙƒØ© Ù‚Ù„Ø¨ÙŠ ÙˆÙ…Ø¹Ø¯ØªÙŠ", "ÙŠØ§ Ø³Ø¹Ø¯ÙŠ Ø¨ÙŠÙƒÙŠ", "ÙˆØ´Ùƒ Ø®ÙŠØ± Ø¹Ù„ÙŠØ§", "Ø­Ø¨ Ø­ÙŠØ§ØªÙŠ Ø§Ù„Ø­Ù„Ùˆ", "ÙŠØ§ ÙØ±Ø§ÙˆÙ„Ø©", "ÙŠØ§ Ø¨ÙˆÙ†Ø¨ÙˆÙ†Ø§ÙŠØ©",
        "Ø³ÙƒØ± Ù…Ø­Ù„ÙŠ", "Ø¶Ø­ÙƒØªÙƒ Ø¨ØªÙØªØ­ Ø§Ù„Ù†ÙØ³", "ÙŠØ§ Ø¨Ø±ÙƒØ© Ø§Ù„Ø¨ÙŠØª", "ØªØ§Ø¬ Ø±Ø§Ø³ÙŠ", "ÙŠØ§ Ù…Ù‡Ù†ÙŠØ©", "ÙŠØ§ ØºØ§Ù„ÙŠØ©", "Ø¹ÙŠÙˆÙ†ÙŠ Ù„ÙŠÙƒÙŠ",
        "Ø±ÙˆØ­ÙŠ ÙÙŠÙƒÙŠ", "Ø¹Ù…Ø±ÙŠ ÙƒÙ„Ù‡", "ÙŠØ§ Ù†ÙˆØ± Ø¹ÙŠÙ†ÙŠ", "Ø­Ø¨ÙŠØ¨ØªÙŠ Ø§Ù„Ø´Ø§Ø·Ø±Ø©", "Ù…Ø§ Ø§Ù†Ø­Ø±Ù…Ø´ Ù…Ù†Ùƒ", "ÙŠØ§ Ø³Øª Ø§Ù„Ø³ØªØ§Øª",
        "ØªØ³Ù„Ù… Ø§ÙŠØ¯ÙŠÙƒÙŠ ÙˆØ¹Ù†ÙŠÙƒÙŠ", "ÙŠØ§ Ø¬Ù…ÙŠÙ„", "ÙŠØ§ Ø¹Ø³Ù„ Ø§Ø¨ÙŠØ¶", "Ù‚Ù…Ø± 14", "ÙŠØ§ Ù…Ø¬Ù†Ù†Ø§Ù†ÙŠ", "Ù‚Ù„Ø¨ÙŠ Ø§Ù„ØµØºÙŠØ± Ù„Ø§ ÙŠØªØ­Ù…Ù„"
    ],
    roasts: [
        "Ù‡Ùˆ Ø§Ù„Ø§ÙƒÙ„ Ø¨ÙŠØªØ­Ø±Ù‚ØŸ", "Ø³Ù†Ø© ÙƒÙ…Ø§Ù† ÙˆØ§ÙƒÙˆÙ† Ù…Øª", "ÙÙŠÙ† Ø§Ù„Ø§ÙƒÙ„ ÙŠØ§ Ù‡Ø§Ù†Ù…ØŸ", "Ø§Ù†Ø§ Ø®Ù„Ù„Øª Ù…Ù† Ø§Ù„Ù‚Ø¹Ø¯Ø©", "ÙŠØ§ Ù…Ø³Ù‡Ù„ Ø§Ù„Ø­Ø§Ù„ ÙŠØ§Ø±Ø¨",
        "Ø¬Ø¹Ø§Ø§Ø§Ø§Ø§Ù†", "ÙŠÙ„Ø§ ÙŠØ§ Ù‡Ø§Ù†Ù…", "Ø®Ù„ØµÙŠÙ†Ø§", "Ù‡ÙˆØª", "Ø¨Ù‚Ø§Ù„ÙŠ Ø³Ø§Ø¹Ø© Ù…Ø³ØªÙ†ÙŠ", "Ø§Ù„Ø¹ÙŠØ§Ù„ Ù…Ø§ØªØª Ù…Ù† Ø§Ù„Ø¬ÙˆØ¹", "Ø§Ù†ØªÙŠ Ø¨ØªØ·Ø¨Ø®ÙŠ Ø³Ù„Ø­ÙØ§Ø©ØŸ",
        "ÙŠØ§Ø±Ø¨ ØµØ¨Ø±Ù†ÙŠ", "Ù…Ø´ Ù‡Ù†Ø®Ù„Øµ Ø§Ù„Ù†Ù‡Ø§Ø±Ø¯Ø©", "Ø§Ù„Ù„ÙŠÙ„ Ù„ÙŠÙ„", "Ø·Ø¨ Ø§Ø·Ù„Ø¨ Ø¯Ù„ÙŠÙØ±ÙŠØŸ", "Ø§Ù†Ø¬Ø²Ø²Ø²ÙŠ", "Ø¨Ø·Ù†ÙŠ Ø¨ØªØµÙˆØµÙˆ", "Ø­Ø±Ø§Ù… Ø¹Ù„ÙŠÙƒÙŠ",
        "Ø§ÙŠÙ‡ Ø§Ù„Ø¨Ø·Ø¡ Ø¯Ù‡", "Ø´Ø¯ÙŠ Ø­ÙŠÙ„Ùƒ Ø´ÙˆÙŠØ©", "Ø¹Ø§ÙŠØ² Ø§ÙƒÙ„ Ù…Ø´ Ø§Ù†Ø§Ù…", "ÙŠØ§ Ø³Ø§ØªØ±", "Ø§Ù„Ø¶ÙŠÙˆÙ Ù…Ø´ÙŠÙˆØ§", "Ø§Ù„Ø§ÙƒÙ„ Ø¨Ø±Ø¯", "Ù†Ø³ÙŠØªÙŠÙ†Ø§ ÙˆÙ„Ø§ Ø§ÙŠÙ‡",
        "Ø§Ù†Ø§ Ø®Ù„Ù„Øª", "ÙŠØ§ ÙØªØ§Ø­ ÙŠØ§ Ø¹Ù„ÙŠÙ…", "Ø§Ø³ØªØºÙØ± Ø§Ù„Ù„Ù‡", "Ù‡Ø§ØªÙŠ Ø§ÙŠ Ø­Ø§Ø¬Ø©", "Ù…Ø´ Ù„Ø§Ø²Ù… ØªØ²ÙˆÙ‚ÙŠÙ‡", "Ø§Ù†Ø§ Ù‡Ù…ÙˆØª Ù…Ù† Ø§Ù„Ø¬ÙˆØ¹",
        "ÙÙŠÙ† Ø§Ù„ØºØ¯Ø§", "ÙÙŠÙ† Ø§Ù„Ø¹Ø´Ø§", "ÙŠØ§Ø¯ÙŠ Ø§Ù„Ù†ÙŠÙ„Ø©", "ÙŠÙ„Ø§ Ø¨Ù‚Ø§", "Ù…Ø´ Ù‚Ø§Ø¯Ø± Ø§Ø³ØªÙ†Ù‰", "Ù‡Ù‚Ø¹ Ù…Ù† Ø·ÙˆÙ„ÙŠ", "Ø§Ø±Ø­Ù…ÙŠÙ†Ø§", "ÙŠØ§ Ù…Ù†Ø¬ÙŠÙ†ÙŠ",
        "Ù…Ø§Ù„Ùƒ ÙŠØ³Ø·Ø§ Ù…Ø§ ØªØ§ÙƒÙ„ÙŠÙ†ÙŠ", "ÙŠØ§ Ù…Ø¹ÙŠÙ†", "Ø§Ø®ÙŠØ±Ø§ Ø¨ØµÙŠØªÙŠÙ„ÙŠ"
    ],
    bear_empty: [
        "ÙˆØ´Ø­ØªÙƒ ÙˆÙ„Ø§ Ø§ÙŠÙ‡", "Ø¬ÙŠØªÙŠ ÙÙŠ Ù…Ù„Ø¹Ø¨ÙŠ", "Ø§Ù„Ø¬Ù…ÙŠÙ„ ÙØ§Ø¶ÙŠ Ø§Ù„Ù†Ù‡Ø§Ø±Ø¯Ø©ØŸ", "Ø¹Ø§ÙŠØ²Ø© Ø§ÙŠÙ‡ ÙŠØ§ Ø´Ù‚ÙŠØ©", 
        "Ù†ÙˆØ±ØªÙŠ ÙŠØ§ Ù‚Ù„Ø¨ Ø§Ù„Ø¯Ø¨Ø¯ÙˆØ¨", "ÙˆØ­Ø´ØªÙŠÙ†ÙŠ ÙŠØ§ ÙƒØªÙƒÙˆØªØ©", "Ø§ÙŠÙ‡ Ø§Ù„Ù†Ø¸Ø±Ø© Ø¯ÙŠ ğŸ˜‰", "ÙØ§Ø¶ÙŠØ© ÙˆØ¬Ø§ÙŠØ© ØªØªØ¯Ù„Ø¹ÙŠØŸ", 
        "Ø¨Ø­Ø¨Ùƒ ÙˆØ§Ù†ØªÙŠ Ø±Ø§ÙŠÙ‚Ø©", "Ø§Ù„Ù‚Ù„Ø¨ Ù„ÙŠÙƒÙŠ Ù„ÙˆØ­Ø¯Ùƒ", "ØºÙ…Ø²Ø© Ù„Ø¹ÙŠÙˆÙ†Ùƒ", "ÙŠØ§ ÙˆØ§Ø®Ø¯ Ù‚Ù„Ø¨ÙŠ"
    ],
    items: {
        'ğŸ': 'ØªÙØ§Ø­', 'ğŸ': 'Ø¹ÙŠØ´', 'ğŸ¥©': 'Ù„Ø­Ù…Ø©', 'ğŸ¥”': 'Ø¨Ø·Ø§Ø·Ø³', 'ğŸ¥¬': 'Ø®Ø³', 'ğŸ¥­': 'Ù…Ø§Ù†Ø¬Ø§',
        'ğŸ“': 'ÙØ±Ø§ÙˆÙ„Ø©', 'ğŸ¦': 'Ø§ÙŠØ³ ÙƒØ±ÙŠÙ…', 'ğŸ®': 'Ù„Ø¨Ù†', 'â˜•': 'Ø¨Ù†', 'ğŸ§€': 'Ø¬Ø¨Ù†Ø©', 'ğŸš': 'Ø±Ø²',
        'ğŸ¿': 'Ø´ÙŠØ¨Ø³ÙŠ', 'ğŸª': 'ÙƒÙˆÙƒÙŠØ²', 'ğŸ«': 'Ø´ÙŠÙƒÙˆÙ„Ø§ØªØ©', 'ğŸ¥¨': 'Ø¨Ø§ØªÙŠÙ‡',
        'ğŸ”': 'Ø¨Ø±Ø¬Ø±', 'ğŸ¥ª': 'Ø³Ø§Ù†Ø¯ÙˆØªØ´', 'ğŸŸ': 'Ø¨Ø·Ø§Ø·Ø³ Ù…Ø­Ù…Ø±Ø©', 'ğŸ¨': 'Ø§ÙŠØ³ ÙƒØ±ÙŠÙ…', 
        'ğŸ¥¤': 'Ø¹ØµÙŠØ±', 'ğŸ¥§': 'ÙØ·ÙŠØ±Ø©', 'ğŸµ': 'Ù‚Ù‡ÙˆØ©', 'ğŸ¥›': 'ÙƒÙˆØ¨ Ù„Ø¨Ù†', 'ğŸ£': 'Ø³ÙˆØ´ÙŠ',
        'ğŸš¿': 'Ø¯Ø´', 'ğŸ“º': 'ØªÙ„ÙØ²ÙŠÙˆÙ†', 'ğŸ’¤': 'Ù†ÙˆÙ…', 'ğŸ’¬': 'Ø±ØºÙŠ', 'ğŸ›ï¸': 'ØªÙˆØ¶ÙŠØ¨', 'ğŸ’‹': 'kissing time',
        'calm': 'Ø´Ø§ÙŠ Ù…Ù‡Ø¯Ø¦', 'freeze': 'ØªØ¬Ù…ÙŠØ¯ Ø§Ù„ÙˆÙ‚Øª', 'donut': 'Ø¯ÙˆÙ†Øª Ø³Ø±ÙŠØ¹Ø©', 'skip': 'Ø³ÙƒÙŠØ¨ Ù„Ù„Ù…Ø³ØªÙˆÙ‰', 
        'auto_clean': 'ØºØ³Ø§Ù„Ø© Ø§Ø·Ø¨Ø§Ù‚', 'rat_trap': 'Ù…ØµÙŠØ¯Ø© ÙÙŠØ±Ø§Ù†', 'ğŸ­': 'drama time'
    }
};

const DRAMA_DATA = {
    cold_answers: [
        "*rolls_eyes*", "*being_distant*", "*annoyed*", "*passive_aggressive*",
        "*sighs_loudly*", "*stares_blankly*", "k.", "fine.", "*whatever*",
        "*files_nails*", "*checks_phone*", "*fake_smile*", "*judging_you*",
        "*dead_pan*", "*yawns*", "*scoffs*", "*ignores*", "*raises_eyebrow*",
        "*sips_tea*", "*typing...*", "*seen*", "*unimpressed*", "*side_eye*",
        "*blocked*", "*silence*", "*crickets*", "*no_reaction*", "*blinks_slowly*",
        "*leaves_chat*", "*facepalm*", "*cold_stare*", "*checking_watch*"
    ],
    bear_states: [
        "*joking*", "*being_sarcastic*", "*teasing*", "*flirting*",
        "*mansplaining*", "*complaining*", "*whining*", "*asking_stupid_question*",
        "*being_clingy*", "*hungry*", "*bored*", "*overreacting*",
        "*being_dramatic*", "*pouting*", "*acting_cool*", "*forgetting_something*"
    ],
    normal_answers: [
        "Aww really?", "That's nice", "I love you", "Tell me more",
        "You're funny", "So sweet", "Of course dear", "Interesting",
        "Go on", "Wow", "Okay honey", "Sure thing"
    ]
};

const GIFTS = {
    1: 'https://www.google.com/search?q=cute+cat',
    2: 'https://www.google.com/search?q=funny+memes',
    3: 'https://www.google.com/search?q=flowers',
    4: 'https://www.google.com/search?q=chocolates'
};

const FALSE_GIFTS = [
    "ØªØ¹ÙŠØ´ ÙˆØªØ¢ÙƒÙ„ ØºÙŠØ±Ù‡Ø§", "Ø­Ø¸ Ø³Ø¹ÙŠØ¯ Ø§Ù„Ù…Ø±Ø© Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©", "Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰", "Ø§Ù„Ù‡Ø¯ÙŠØ© ÙÙŠ Ø¬ÙŠØ¨Ùƒ", "Ù…ÙÙŠØ´ Ù‡Ø¯Ø§ÙŠØ§ Ø§Ù„Ù†Ù‡Ø§Ø±Ø¯Ø©", 
    "Ø¨ØªØ­Ù„Ù… Ø¨Ø§ÙŠÙ†", "Ø§Ù†Ø³Ù‰", "ÙŠØ§ Ø®Ø³Ø§Ø±Ø©", "Ø®ÙŠØ±Ù‡Ø§ ÙÙŠ ØºÙŠØ±Ù‡Ø§", "Ù…Ø´ Ù…ÙƒØªÙˆØ¨Ø§Ù„Ùƒ", "Ø§Ù„Ù…Ø±Ø© Ø§Ù„Ø¬Ø§ÙŠØ© Ø§Ù† Ø´Ø§Ø¡ Ø§Ù„Ù„Ù‡", "Ø§Ù†Øª ØµØ¯Ù‚ØªØŸ", 
    "Ø¶Ø­ÙƒØª Ø¹Ù„ÙŠÙƒ", "Ø§Ø¬Ø±ÙŠ Ø§Ù„Ø¹Ø¨ Ø¨Ø¹ÙŠØ¯", "ÙˆÙØ± ÙÙ„ÙˆØ³Ùƒ", "Ø§Ù„Ù‡Ø¯ÙŠØ© Ø®Ù„ØµØª", "Ù…ÙÙŠØ´ Ù…ÙŠØ²Ø§Ù†ÙŠØ©", "Ø§Ù„Ø¯Ø¨ Ø§ÙƒÙ„ Ø§Ù„Ù‡Ø¯ÙŠØ©", "Ø­Ø¸ Ø§ÙˆÙØ±", "Ù…ØªØ²Ø¹Ù„Ø´", "Ø¬Ø±Ø¨ ØªØ§Ù†ÙŠ"
];

const INGREDIENTS = {
    'ğŸ': { u: 1 }, 'ğŸ': { u: 1 }, 'ğŸ¥©': { u: 1 }, 'ğŸ¥¬': { u: 1 },
    'ğŸ¥”': { u: 2 }, 
    'ğŸ¥­': { u: 3 }, 'ğŸ¦': { u: 3 }, 
    'ğŸ“': { u: 4 }, 'â˜•': { u: 4 },
    'ğŸ¿': { u: 5 }, 'ğŸª': { u: 5 }, 'ğŸ«': { u: 5 }, 'ğŸ¥¨': { u: 5 },
    'ğŸš': { u: 6 }
};

const RECIPES = {
    'ğŸ¥©': { out: 'ğŸ”', s: 'stove', t: 3000 },
    'ğŸ': { out: 'ğŸ¥ª', s: 'prep', t: 1000 },
    'ğŸ¥”': { out: 'ğŸŸ', s: 'fryer', t: 3000 },
    'ğŸ¥­': { out: 'ğŸ¨', s: 'icecream', t: 4000 },
    'ğŸ¦': { out: 'ğŸ¨', s: 'icecream', t: 4000 },
    'ğŸ“': { out: 'ğŸ¥¤', s: 'prep', t: 2000 },
    'ğŸ': { out: 'ğŸ¥§', s: 'oven', t: 4000 },
    'â˜•': { out: 'ğŸµ', s: 'coffee-machine', t: 5000 },
    'ğŸš': { out: 'ğŸ£', s: 'sushi-maker', t: 4500 },
    'empty_cup': { out: 'ğŸ¥›', s: 'cow-station', t: 4000 }
};

const SHOP_DATA = [
    { id: 'stove_upg', name: 'Ø¨ÙˆØªØ§Ø¬Ø§Ø² Ø¬Ø¯ÙŠØ¯', price: 500, cat: 'kitchen', type: 'perm', desc: 'Ø´ÙƒÙ„ Ø¬Ø¯ÙŠØ¯' },
    { id: 'fridge_upg', name: 'ØªÙ„Ø§Ø¬Ø© Ù…ÙˆØ¯Ø±Ù†', price: 600, cat: 'kitchen', type: 'perm', desc: 'Ø´ÙƒÙ„ Ø¬Ø¯ÙŠØ¯' },
    { id: 'oven_upg', name: 'ÙØ±Ù† ÙƒÙ‡Ø±Ø¨Ø§', price: 550, cat: 'kitchen', type: 'perm', desc: 'Ø´ÙƒÙ„ Ø¬Ø¯ÙŠØ¯' },
    { id: 'prep_upg', name: 'ØªØ±Ø§Ø¨ÙŠØ²Ø© Ø±Ø®Ø§Ù…', price: 400, cat: 'kitchen', type: 'perm', desc: 'Ø´ÙƒÙ„ Ø¬Ø¯ÙŠØ¯' },
    { id: 'sink_upg', name: 'Ø­ÙˆØ¶ Ø³ÙŠØ±Ø§Ù…ÙŠÙƒ', price: 450, cat: 'kitchen', type: 'perm', desc: 'Ø´ÙƒÙ„ Ø¬Ø¯ÙŠØ¯' },
    { id: 'coffee_upg', name: 'Ù…Ø§ÙƒÙŠÙ†Ø© Ø§Ø³Ø¨Ø±Ø³Ùˆ', price: 700, cat: 'kitchen', type: 'perm', desc: 'Ø´ÙƒÙ„ Ø¬Ø¯ÙŠØ¯' },
    { id: 'ice_upg', name: 'Ø§ÙŠØ³ ÙƒØ±ÙŠÙ…', price: 650, cat: 'kitchen', type: 'perm', desc: 'Ø´ÙƒÙ„ Ø¬Ø¯ÙŠØ¯' },
    { id: 'fryer_upg', name: 'Ù‚Ù„Ø§ÙŠØ© Ù‡ÙˆØ§Ø¦ÙŠØ©', price: 600, cat: 'kitchen', type: 'perm', desc: 'Ø´ÙƒÙ„ Ø¬Ø¯ÙŠØ¯' },
    { id: 'floor_k', name: 'Ø¨Ù„Ø§Ø· Ù…Ø·Ø¨Ø®', price: 300, cat: 'kitchen', type: 'perm', desc: 'ØªØºÙŠÙŠØ± Ø§Ù„Ø§Ø±Ø¶ÙŠØ©' },
    { id: 'wall_k', name: 'Ø¯Ù‡Ø§Ù† Ù…Ø·Ø¨Ø®', price: 300, cat: 'kitchen', type: 'perm', desc: 'ØªØºÙŠÙŠØ± Ø§Ù„Ø­ÙŠØ·Ø©' },

    { id: 'sofa_upg', name: 'Ø§Ù†ØªØ±ÙŠÙ‡ Ø¬Ù„Ø¯', price: 800, cat: 'living', type: 'perm', desc: 'Ø´ÙƒÙ„ Ø¬Ø¯ÙŠØ¯' },
    { id: 'tv_upg', name: 'Ø´Ø§Ø´Ø© Ø³Ù…Ø§Ø±Øª', price: 1000, cat: 'living', type: 'perm', desc: 'Ø´ÙƒÙ„ Ø¬Ø¯ÙŠØ¯' },
    { id: 'bed_upg', name: 'Ø³Ø±ÙŠØ± Ù…Ù„ÙˆÙƒÙŠ', price: 900, cat: 'living', type: 'perm', desc: 'Ø´ÙƒÙ„ Ø¬Ø¯ÙŠØ¯' },
    { id: 'shower_upg', name: 'Ø¬Ø§ÙƒÙˆØ²ÙŠ', price: 1200, cat: 'living', type: 'perm', desc: 'Ø´ÙƒÙ„ Ø¬Ø¯ÙŠØ¯' },
    { id: 'rug_l', name: 'Ø³Ø¬Ø§Ø¯Ø© ÙØ±Ùˆ', price: 400, cat: 'living', type: 'perm', desc: 'Ø¯ÙŠÙƒÙˆØ±' },
    { id: 'lamp_l', name: 'Ø§Ø¨Ø§Ø¬ÙˆØ±Ø©', price: 300, cat: 'living', type: 'perm', desc: 'Ø¯ÙŠÙƒÙˆØ±' },
    { id: 'plant_l', name: 'Ø²Ø±Ø¹Ø© Ø²ÙŠÙ†Ø©', price: 200, cat: 'living', type: 'perm', desc: 'Ø¯ÙŠÙƒÙˆØ±' },
    { id: 'win_l', name: 'Ø³ØªØ§Ø¦Ø±', price: 350, cat: 'living', type: 'perm', desc: 'Ø¯ÙŠÙƒÙˆØ±' },
    { id: 'book_l', name: 'Ù…ÙƒØªØ¨Ø©', price: 500, cat: 'living', type: 'perm', desc: 'Ø¯ÙŠÙƒÙˆØ±' },
    { id: 'paint_l', name: 'Ø¯Ù‡Ø§Ù† ØµØ§Ù„Ø©', price: 400, cat: 'living', type: 'perm', desc: 'ØªØºÙŠÙŠØ± Ø§Ù„Ø­ÙŠØ·Ø©' },

    { id: 'speed1', name: 'Speed Boots I ğŸ‘¢', price: 100, cat: 'boosts', type: 'perm', desc: '+20% Speed' },
    { id: 'cap1', name: 'Big Hands I âœ‹', price: 150, cat: 'boosts', type: 'perm', desc: 'Carry 4 Items' },
    { id: 'clean1', name: 'Super Sponge ğŸ§½', price: 200, cat: 'boosts', type: 'perm', desc: 'Clean 2x Faster' },
    { id: 'auto_clean', name: 'Auto Dishwasher ğŸ¤–', price: 800, cat: 'boosts', type: 'perm', desc: 'Auto Clean Plates' },
    { id: 'rat_trap', name: 'Rat Trap ğŸª¤', price: 400, cat: 'boosts', type: 'perm', desc: 'Auto Kill Rats' },
    { id: 'drone', name: 'Drone Delivery ğŸš', price: 600, cat: 'boosts', type: 'perm', desc: 'Instant Ingredients' },
    { id: 'freeze', name: 'Time Freeze â„ï¸', price: 50, cat: 'boosts', type: 'cons', desc: 'Stop timer 15s' },
    { id: 'donut', name: 'Cold Donut ğŸ©', price: 75, cat: 'boosts', type: 'cons', desc: 'Instant Cooking' },
    { id: 'skip', name: 'Level Skip â©', price: 2000, cat: 'boosts', type: 'cons', desc: 'Skip Level' },
    { id: 'calm', name: 'Calming Tea ğŸµ', price: 40, cat: 'boosts', type: 'cons', desc: '-30 Anger' }
];

const CHALLENGES = {
    5: { name: 'Rat Invasion', ratRate: 2 },
    10: { name: 'Dust Storm', dirtRate: 3 },
    15: { name: 'Rush Hour', orderSpeed: 1.5 },
    20: { name: 'Grumpy Day', angerRate: 1.5 },
    25: { name: 'Broken Stove', machineSlow: 2 },
    30: { name: 'Inflation', tips: 0.5 },
    35: { name: 'Chaos Mode', ratRate: 3, dirtRate: 3, angerRate: 2 },
    40: { name: 'The Ultimate Test', allHard: true }
};

const CACHE = {};
function cacheDOM() {
    ['h-lvl','h-cash','ui-lives','ui-xp-left','anger-fill','xp-fill',
     'dirty-plates','bear-container','the-bear','speech-bubble','orders-container',
     'heba','world','game-over-modal','level-complete-modal','menu-title','menu-grid', 'menu-footer',
     'generic-menu-modal','jump-heba','jump-bear','happy-val','happy-bar-fill', 'start-info', 'washing-game', 
     'kissing-game', 'sleep-game', 'shop-tabs', 'inventory-display', 'gift-modal', 'inventory-modal', 'inv-grid',
     'drama-game', 'drama-chat-view'].forEach(id => CACHE[id] = document.getElementById(id));
}

(function initSplashContent() {
    const bearMsg = document.getElementById('splash-bear-msg');
    const chickHearts = document.getElementById('splash-chick-hearts');
    
    setInterval(() => {
        const msg = TEXT.flirts[Math.floor(Math.random() * TEXT.flirts.length)];
        bearMsg.innerText = msg;
    }, 2500);
    bearMsg.innerText = TEXT.flirts[0];

    setInterval(() => {
        const h = document.createElement('div');
        const hearts = ['â¤ï¸', 'ğŸ’–', 'ğŸ’•', 'ğŸ’“', 'ğŸ’—'];
        h.innerText = hearts[Math.floor(Math.random() * hearts.length)];
        h.className = 'splash-heart-anim';
        h.style.left = (Math.random() * 40) + 'px';
        chickHearts.appendChild(h);
        setTimeout(() => h.remove(), 1500);
    }, 500);
})();

const Game = {
    active: false, mode: 'normal', level: 1, cash: 100, 
    dirtyPlates: 0, maxPlates: 5, platesServed: 0,
    lives: 4, xp: 0, xpTarget: 100,
    levelTimer: 0, lastTime: 0,
    modifiers: {}, hackerClicks: 0, activeShopCat: 'kitchen',
    activeChallenge: null, inventory: [],
    isProcessingLevel: false,
    
    initSplash() {
        document.getElementById('splash-screen').style.opacity = '0';
        this.playSound('click');
        const aud = document.getElementById('bg-music');
        aud.volume = 0.3;
        aud.play().catch(e => console.log('Audio blocked'));
        setTimeout(() => {
            document.getElementById('splash-screen').style.display = 'none';
            document.getElementById('start-modal').style.display = 'flex';
        }, 500);
    },

    playSound(id) {
        const el = document.getElementById('sfx-' + id);
        if(el) {
            el.currentTime = 0;
            el.play().catch(e => {});
        }
    },

    start() {
        cacheDOM();
        this.playSound('click');
        const savedLvl = localStorage.getItem('heba_level');
        this.level = savedLvl ? parseInt(savedLvl) : 1;
        document.getElementById('start-modal').style.display = 'none';
        this.startLevel(this.level);
        
        const savedCash = localStorage.getItem('heba_cash');
        if(savedCash) this.cash = parseInt(savedCash);
        const savedXp = localStorage.getItem('heba_xp');
        if(savedXp) this.xp = parseInt(savedXp);
        const savedAnger = localStorage.getItem('heba_anger');
        if(savedAnger) Bear.anger = parseInt(savedAnger);
        
        this.updateHUD();
        Bear.updateStats();
        
        requestAnimationFrame(t => this.loop(t));
    },

    startLevel(lvl) {
        this.level = lvl;
        this.active = true;
        this.mode = 'normal';
        
        this.lives = 4;
        this.xp = 0;
        this.xpTarget = 100 + (lvl * 20);
        
        this.platesServed = 0;
        this.dirtyPlates = 0;
        
        this.activeChallenge = CHALLENGES[lvl] || null;
        if(this.activeChallenge) {
            CACHE['start-info'].innerText = `Challenge: ${this.activeChallenge.name}`;
            CACHE['start-modal'].style.display = 'flex';
            this.active = false;
        } else {
            CACHE['start-info'].innerText = "";
        }

        if(this.modifiers['second']) this.hasRevive = true;

        document.getElementById('player-sprite').innerText = 'ğŸ¥';
        document.getElementById('the-bear').innerText = 'ğŸ§¸';

        Bear.reset();
        World.reset();
        this.updateHUD();
        this.checkUnlocks();
        this.applyVisuals();
        this.closeModals();
        Bear.startLogic();
    },

    nextLevel() {
        if(this.isProcessingLevel) return;
        this.isProcessingLevel = true;
        
        this.playSound('click');
        const next = this.level + 1;
        localStorage.setItem('heba_level', next);
        
        document.getElementById('gift-modal').style.display = 'none';
        
        this.startLevel(next);
        
        setTimeout(() => { this.isProcessingLevel = false; }, 1000);
    },

    restartLevel() {
        this.playSound('click');
        this.startLevel(this.level);
    },

    checkUnlocks() {
        const s = (id, show) => document.getElementById(id).style.display = (show ? 'flex' : 'none');
        s('fryer', this.level >= 2);
        s('icecream', this.level >= 3);
        s('coffee-machine', this.level >= 4);
        s('cow-station', this.level >= 5);
        s('snacks-area', this.level >= 5);
        s('sushi-maker', this.level >= 6);
        s('stove2', this.level >= 15);
        s('prep2', this.level >= 20);
        s('fryer2', this.level >= 25);
        s('oven2', this.level >= 30);
    },

    applyVisuals() {
        const map = {
            'stove': 'stove_upg', 'fridge': 'fridge_upg', 'oven': 'oven_upg',
            'prep': 'prep_upg', 'sink': 'sink_upg', 'coffee-machine': 'coffee_upg',
            'icecream': 'ice_upg', 'fryer': 'fryer_upg', 'sofa': 'sofa_upg',
            'tv': 'tv_upg', 'bed': 'bed_upg', 'shower': 'shower_upg'
        };
        for(let k in map) {
            const el = document.getElementById(k);
            const vis = el.querySelector('.vis');
            if(vis) {
                if(this.modifiers[map[k]]) {
                    vis.innerHTML = `<img src="https://placehold.co/50x50/png?text=UPG" class="obj-img">`;
                }
            }
        }
        if(this.modifiers['floor_k']) document.getElementById('zone-kitchen').style.backgroundImage = 'radial-gradient(#009688 2px, transparent 2px)';
        if(this.modifiers['wall_k']) document.getElementById('zone-kitchen').style.backgroundColor = '#E0F2F1';
        if(this.modifiers['paint_l']) document.getElementById('zone-living').style.backgroundColor = '#FCE4EC';
    },

    updateHUD() {
        CACHE['h-lvl'].innerText = this.level;
        CACHE['h-cash'].innerText = Math.floor(this.cash);
        CACHE['ui-lives'].innerText = "ğŸ’›".repeat(this.lives);
        CACHE['ui-xp-left'].innerText = Math.max(0, this.xpTarget - this.xp);
        CACHE['dirty-plates'].innerText = this.dirtyPlates;
        CACHE['dirty-plates'].style.display = this.dirtyPlates > 0 ? 'flex' : 'none';
        
        const xpPct = Math.min(100, (this.xp / this.xpTarget) * 100);
        CACHE['xp-fill'].style.width = xpPct + '%';
    },

    winLevel() {
        this.active = false;
        this.playSound('success');
        
        var duration = 3000;
        var end = Date.now() + duration;
        (function frame() {
          confetti({
            particleCount: 5, angle: 60, spread: 55, origin: { x: 0 },
            colors: ['#ff0000', '#00ff00', '#0000ff', '#ffff00']
          });
          confetti({
            particleCount: 5, angle: 120, spread: 55, origin: { x: 1 },
            colors: ['#ff0000', '#00ff00', '#0000ff', '#ffff00']
          });
          if (Date.now() < end) requestAnimationFrame(frame);
        }());

        const stats = document.getElementById('level-stats');
        stats.innerHTML = `
            <div style="display:flex; justify-content:space-between; margin:10px 0; border-bottom:1px solid #ddd;"><span>Ø§Ù„ÙÙ„ÙˆØ³:</span><span>${Math.floor(this.cash)}</span></div>
            <div style="display:flex; justify-content:space-between; margin:10px 0; border-bottom:1px solid #ddd;"><span>Ø§Ù„Ø§Ø·Ø¨Ø§Ù‚:</span><span>${this.platesServed}</span></div>
            <div style="display:flex; justify-content:space-between; margin:10px 0; border-bottom:1px solid #ddd;"><span>Ø§Ù„Ø±Ø¶Ø§:</span><span>${100 - Math.floor(Bear.anger)}%</span></div>
        `;
        this.modifiers['donut'] = false;
        this.modifiers['freeze'] = false;
        CACHE['level-complete-modal'].style.display = 'flex';
    },

    gameOver() {
        if(this.hasRevive) {
            this.hasRevive = false;
            this.lives += 1;
            Bear.anger = 0;
            Bear.say("ÙØ±ØµØ© ØªØ§Ù†ÙŠØ© â¤ï¸");
            return;
        }
        this.active = false;
        CACHE['game-over-modal'].style.display = 'flex';
    },

    toggleShop() {
        this.playSound('modal');
        this.renderShop();
        CACHE['generic-menu-modal'].style.display = 'flex';
    },

    renderShop() {
        CACHE['menu-title'].innerText = `Ø§Ù„Ù…ØªØ¬Ø± ğŸ›’`;
        CACHE['shop-tabs'].style.display = 'flex';
        CACHE['shop-tabs'].innerHTML = `
            <div class="tab-btn ${this.activeShopCat=='kitchen'?'active':''}" onclick="Game.setShopCat('kitchen')">Ù…Ø·Ø¨Ø®</div>
            <div class="tab-btn ${this.activeShopCat=='living'?'active':''}" onclick="Game.setShopCat('living')">ØµØ§Ù„Ø©</div>
            <div class="tab-btn ${this.activeShopCat=='boosts'?'active':''}" onclick="Game.setShopCat('boosts')">Ù‚Ø¯Ø±Ø§Øª</div>
        `;
        
        CACHE['menu-grid'].innerHTML = '';
        const pageItems = SHOP_DATA.filter(i => i.cat === this.activeShopCat);
        pageItems.forEach(item => {
            let owned = this.modifiers[item.id];
            let inInv = this.inventory.filter(x => x === item.id).length;
            
            let btnText = 'BUY';
            let btnClass = '';
            
            if(item.type === 'perm') {
                if(owned) { btnText = 'OWNED'; btnClass = 'shop-owned'; }
            } else {
                if(inInv > 0) { btnText = 'IN BAG'; btnClass = 'shop-owned'; }
            }
            
            const div = document.createElement('div');
            div.className = 'shop-item';
            
            let indic = '';
            if(owned) indic = `<div class="shop-indicator">âœ”</div>`;
            else if(inInv > 0) indic = `<div class="shop-indicator">${inInv}</div>`;

            div.innerHTML = `
                ${indic}
                <div>${item.name}</div>
                <div style="font-size:10px; margin:2px 0;">${item.desc}</div>
                <div style="font-size:12px; color:green">$${item.price}</div>
                <button class="shop-buy-btn ${btnClass}" onclick="Game.buyItem('${item.id}', ${item.price}, '${item.type}')">${btnText}</button>
            `;
            CACHE['menu-grid'].appendChild(div);
        });

        const footer = CACHE['menu-footer'];
        footer.innerHTML = `
            <div class="shop-nav">
                <div class="hacker-btn" onclick="Game.hackerCheck()"></div>
            </div>
        `;
    },

    setShopCat(cat) {
        this.playSound('click');
        this.activeShopCat = cat;
        this.renderShop();
    },

    buyItem(id, cost, type) {
        this.playSound('click');
        if(type === 'perm' && this.modifiers[id]) return;
        
        if(type === 'cons' && this.inventory.includes(id)) return;

        if(this.cash >= cost) {
            this.cash -= cost;
            if(type === 'perm') {
                this.modifiers[id] = true;
                this.applyVisuals();
            } else {
                this.inventory.push(id);
            }
            this.updateHUD();
            this.renderShop();
        }
    },

    openInventory() {
        this.playSound('modal');
        const grid = CACHE['inv-grid'];
        grid.innerHTML = '';
        if(this.inventory.length === 0) {
            grid.innerHTML = '<div style="grid-column:1/-1; text-align:center;">Ø§Ù„Ø´Ù†Ø·Ø© ÙØ§Ø¶ÙŠØ©</div>';
        } else {
            this.inventory.forEach((item, idx) => {
                const meta = SHOP_DATA.find(x => x.id === item);
                const div = document.createElement('button');
                div.className = 'menu-btn';
                div.innerHTML = meta ? meta.name : item;
                div.onclick = () => {
                    this.useConsumable(item);
                    this.inventory.splice(idx, 1);
                    this.closeModals();
                };
                grid.appendChild(div);
            });
        }
        CACHE['inventory-modal'].style.display = 'flex';
    },

    useConsumable(id) {
        if(id === 'calm') { Bear.anger = Math.max(0, Bear.anger - 30); Bear.updateStats(); Bear.say("Ù‡Ø¯ÙŠØª Ø´ÙˆÙŠØ© ğŸµ"); }
        if(id === 'nuke') { World.rats.forEach(r => r.remove()); World.rats=[]; Bear.say("Ø¨ÙˆÙ…! ğŸ’£"); }
        if(id === 'freeze') { this.modifiers['freeze'] = true; setTimeout(() => this.modifiers['freeze'] = false, 15000); }
        if(id === 'donut') { this.modifiers['donut'] = true; Bear.say("Ø³Ø±Ø¹Ø© Ø§Ù„Ø¨Ø±Ù‚! âš¡"); }
        if(id === 'skip') { this.winLevel(); }
    },
    
    hackerCheck() {
        this.hackerClicks++;
        if(this.hackerClicks === 7) {
            this.closeModals();
            this.initHacker();
            document.getElementById('hacker-modal').style.display = 'flex';
            this.hackerClicks = 0;
        }
    },

    initHacker() {
        const sel = document.getElementById('hack-lvl-sel');
        sel.innerHTML = '';
        for(let i=1; i<=40; i++) {
            const opt = document.createElement('option');
            opt.value = i;
            opt.innerText = "Level " + i;
            sel.appendChild(opt);
        }
        sel.value = this.level;
    },

    hackerUpdate() {
        const d = document.getElementById('hacker-stats');
        if(document.getElementById('hacker-modal').style.display === 'flex') {
            d.innerHTML = `ANGER: ${Math.floor(Bear.anger)} | ORDERS: ${Bear.orders.length}<br>STRENGTH: ${Math.floor(Bear.strength)} | TIME: ${Math.floor(Bear.nextOrderTimer)}`;
        }
    },

    setHackLevel() {
        const val = document.getElementById('hack-lvl-sel').value;
        this.closeModals();
        this.startLevel(parseInt(val));
        localStorage.setItem('heba_level', val);
    },

    setHackCash() {
        const val = document.getElementById('hack-cash-in').value;
        if(val) {
            this.cash = parseInt(val);
            this.updateHUD();
            localStorage.setItem('heba_cash', this.cash);
        }
    },

    setHackXP() {
        const val = document.getElementById('hack-xp-in').value;
        if(val) { 
            this.xp = parseInt(val); 
            this.updateHUD(); 
            localStorage.setItem('heba_xp', this.xp);
        }
    },

    setHackAnger() {
        const val = document.getElementById('hack-anger-in').value;
        if(val) { 
            Bear.anger = parseInt(val); 
            Bear.updateStats(); 
            localStorage.setItem('heba_anger', Bear.anger);
        }
    },
    
    runHackCode() {
        const code = document.getElementById('hack-eval').value;
        try { eval(code); } catch(e) { alert(e); }
    },

    saveSettings() {
        localStorage.setItem('heba_level', this.level);
        localStorage.setItem('heba_cash', this.cash);
        localStorage.setItem('heba_xp', this.xp);
        sessionStorage.setItem('heba_cache', JSON.stringify({l: this.level, c: this.cash, x: this.xp}));
        alert('Saved!');
    },

    resetEverything() {
        if(confirm('Reset all progress?')) {
            localStorage.clear();
            sessionStorage.clear();
            location.reload();
        }
    },

    hardReset() {
        localStorage.clear();
        sessionStorage.clear();
        location.reload();
    },

    addCash(amt) {
        this.cash += amt;
        this.updateHUD();
    },

    unlockAll() {
        this.level = 40;
        this.checkUnlocks();
        this.updateHUD();
    },

    openRecipes() {
        this.playSound('modal');
        const l = document.getElementById('recipe-list');
        l.innerHTML = '';
        for(let r in RECIPES) {
            if(INGREDIENTS[r] && INGREDIENTS[r].u <= this.level) 
                l.innerHTML += `<div>${TEXT.items[r] || r} â¬…ï¸ ${TEXT.items[RECIPES[r].out] || RECIPES[r].out}</div>`;
        }
        l.innerHTML += `<div>Ø§ÙŠ Ø­Ø§Ø¬Ø© ØªØ§Ù†ÙŠØ© Ø¨ØªØªØ§ÙƒÙ„ Ø¹Ù„Ù‰ Ø·ÙˆÙ„!</div>`;
        document.getElementById('recipe-modal').style.display = 'flex';
    },

    closeModals() {
        this.playSound('modal');
        document.querySelectorAll('.modal-overlay').forEach(e => e.style.display = 'none');
        document.getElementById('sleep-game').style.display = 'none';
        document.getElementById('washing-game').style.display = 'none';
        document.getElementById('kissing-game').style.display = 'none';
        document.getElementById('drama-game').style.display = 'none';
        document.getElementById('gift-modal').style.display = 'none';
        document.getElementById('generic-menu-modal').classList.remove('frost-theme');
        Game.mode = 'normal';
    },

    loop(t) {
        if(!this.active) {
            if(document.getElementById('hacker-modal').style.display === 'flex') this.hackerUpdate();
            return requestAnimationFrame(k => this.loop(k));
        }
        const dt = (t - this.lastTime) / 1000;
        this.lastTime = t;

        if(this.mode === 'normal') {
            
            Bear.update(dt);
            World.update(dt);
            
            if(this.modifiers['auto_clean'] && this.dirtyPlates > 0 && Math.random() < 0.01) {
                this.dirtyPlates--;
                this.updateHUD();
            }

            if(this.xp >= this.xpTarget) return this.winLevel();
            this.updateHUD();
        } else if(this.mode === 'sleep') {
            SleepGame.update(dt);
        }
        
        if(document.getElementById('hacker-modal').style.display === 'flex') this.hackerUpdate();
        requestAnimationFrame(k => this.loop(k));
    }
};

const Bear = {
    x: 50, y: 50, anger: 0, strength: 0, orders: [], nextOrderTimer: 2, ratTarget: null, ratTimer: 0,
    msgTimer: null,
    
    reset() {
        this.anger = 0; this.strength = 0; this.orders = []; this.nextOrderTimer = 2;
        this.ratTarget = null; this.ratTimer = 0;
        CACHE['orders-container'].innerHTML = '';
        this.updateStats();
        this.move(50, 20);
    },
    
    startLogic() { this.logicLoop(); },
    
    logicLoop() {
        if(!Game.active || Game.mode !== 'normal') return setTimeout(() => this.logicLoop(), 1000);
        
        if(!this.ratTarget && Math.random() < 0.3) {
            this.move(Math.random()*60 + 20, Math.random()*80 + 10);
        }
        
        setTimeout(() => this.logicLoop(), 4000);
    },

    move(x, y) {
        if(x > this.x) CACHE['the-bear'].style.transform = "scaleX(-1)"; else CACHE['the-bear'].style.transform = "scaleX(1)";
        this.x = x; this.y = y;
        CACHE['bear-container'].style.left = `calc(${x}% - 40px)`;
        CACHE['bear-container'].style.top = `calc(${y}% - 40px)`;
    },

    update(dt) {
        let strDecay = 5;
        if(Game.modifiers['str_boost']) strDecay = 4;
        this.strength = Math.max(0, this.strength - (strDecay * dt));
        
        let angryRate = this.orders.length > 0 ? (this.orders.length * 1.5) : -2;
        if(Game.modifiers['anger_red'] && angryRate > 0) angryRate *= 0.8;
        if(Game.activeChallenge && Game.activeChallenge.angerRate) angryRate *= Game.activeChallenge.angerRate;
        if(Game.activeChallenge && Game.activeChallenge.allHard) angryRate *= 1.5;

        this.anger = Math.max(0, Math.min(100, this.anger + (angryRate * dt)));
        this.updateStats();
        if(this.anger >= 100) Game.gameOver();

        let orderSpeed = Game.level * 0.1;
        if(Game.activeChallenge && Game.activeChallenge.orderSpeed) orderSpeed *= 1.5;
        
        this.nextOrderTimer -= dt;
        if(this.nextOrderTimer <= 0) {
            let maxOrders = 1 + Math.floor(Game.level / 5);
            if(maxOrders > 6) maxOrders = 6;
            if(this.orders.length < maxOrders) this.addOrder();
            this.nextOrderTimer = Math.max(2, 10 - orderSpeed);
        }

        if(Game.modifiers['rat_trap'] && World.rats.length > 0) {
            World.rats[0].click();
        }

        if(this.strength > 20 && World.rats.length > 0) {
            World.rats.forEach(r => {
                const boom = document.createElement('div');
                boom.innerText = 'ğŸ’¥';
                boom.style.position = 'absolute';
                boom.style.left = r.style.left;
                boom.style.top = r.style.top;
                boom.style.fontSize = '40px';
                boom.style.zIndex = '100';
                CACHE['world'].appendChild(boom);
                setTimeout(() => boom.remove(), 1000);
                r.remove();
            });
            const killCount = World.rats.length;
            World.rats = [];
            this.strength = Math.max(0, this.strength - (killCount * 10));
            Game.cash += (killCount * 5);
            this.say("Ø§Ø¨Ø¹Ø¯ÙˆØ§ Ø¹Ù† Ø§ÙƒÙ„ÙŠ! ğŸ¦");
        }

        this.orders.forEach(o => {
            o.timer += dt;
            const el = document.getElementById('ord-'+o.id);
            if(el) {
                const fill = Math.min(100, (o.timer / o.maxTime) * 100);
                el.querySelector('.cooldown-circle').style.background = `conic-gradient(#f44336 ${fill}%, #eee ${fill}%)`;
                if(fill >= 100) {
                    this.anger += 10;
                    o.timer = 0;
                    this.say(TEXT.roasts[Math.floor(Math.random()*TEXT.roasts.length)]);
                }
            }
        });
    },

    addOrder(reqType) {
        const id = Date.now() + Math.random();
        let type = 'food';
        let item = 'ğŸ”';
        
        if (reqType === 'specific_food') {
            type = 'food';
            const unlocked = Object.keys(INGREDIENTS).filter(k => INGREDIENTS[k].u <= Game.level);
            const raw = unlocked[Math.floor(Math.random()*unlocked.length)];
            item = RECIPES[raw] ? (Math.random() > 0.3 ? RECIPES[raw].out : raw) : raw;
        } else if (reqType === 'quality_time') {
            type = 'quality';
            const opts = ['ğŸš¿','ğŸ“º','ğŸ’¤','ğŸ’¬','ğŸ›ï¸', 'ğŸ­'];
            item = opts[Math.floor(Math.random()*opts.length)];
        } else if (reqType === 'kisses') {
            type = 'quality';
            item = 'ğŸ’‹';
        } else {
            if(Math.random() < 0.3) type = 'quality';
            
            if(type === 'food') {
                const unlocked = Object.keys(INGREDIENTS).filter(k => INGREDIENTS[k].u <= Game.level);
                const raw = unlocked[Math.floor(Math.random()*unlocked.length)];
                item = RECIPES[raw] ? (Math.random() > 0.3 ? RECIPES[raw].out : raw) : raw;
            } else {
                const opts = ['ğŸš¿','ğŸ“º','ğŸ’¤','ğŸ’¬','ğŸ›ï¸', 'ğŸ’‹', 'ğŸ­'];
                item = opts[Math.floor(Math.random()*opts.length)];
            }
        }

        const order = { id, item, type, timer: 0, maxTime: Math.max(8, 20 - (Game.level * 0.2)) };
        this.orders.push(order);
        
        const div = document.createElement('div');
        div.className = 'order-bubble'; div.id = 'ord-'+id;
        div.innerHTML = `<div class="cooldown-circle"></div><span>${item}</span>`;
        CACHE['orders-container'].appendChild(div);
        
        Game.playSound('pop');

        this.say(type === 'food' ? "Ù‡Ù… Ù‡Ù… Ù‡Ù… ğŸ˜‹" : "Ø¹Ø§ÙŠØ² Ø§Ù‡ØªÙ…Ø§Ù…! â¤ï¸");
    },

    completeOrder(idx) {
        Game.playSound('ding');
        const o = this.orders[idx];
        const el = document.getElementById('ord-'+o.id);
        if(el) el.remove();
        this.orders.splice(idx, 1);
        this.anger = Math.max(0, this.anger - 15);
        
        let cash = 15;
        if(Game.modifiers['double_cash']) cash *= 1.5;
        if(Game.activeChallenge && Game.activeChallenge.tips) cash *= Game.activeChallenge.tips;
        
        Game.cash += cash;
        Game.xp += 15;
        
        if(o.type === 'food') {
            Game.platesServed++;
            Game.dirtyPlates++;
            this.strength = Math.min(100, this.strength + 10);
            this.spawnHeart();
        }
        this.say(TEXT.flirts[Math.floor(Math.random()*TEXT.flirts.length)]);
        Game.updateHUD();
    },

    spawnHeart() {
        const hearts = ['ğŸ’–', 'ğŸ’•', 'ğŸ’“', 'ğŸ’—', 'â¤ï¸', 'ğŸ’', 'ğŸ’˜'];
        const h = document.createElement('div');
        h.innerText = hearts[Math.floor(Math.random() * hearts.length)];
        h.className = 'kisses-effect';
        h.style.left = this.x + '%';
        h.style.top = this.y + '%';
        CACHE['world'].appendChild(h);
        setTimeout(() => h.remove(), 1500);
    },

    updateStats() {
        CACHE['anger-fill'].style.width = this.anger + '%';
        const angry = this.anger > 60;
        CACHE['the-bear'].innerText = angry ? 'ğŸ»' : 'ğŸ§¸';
    },

    say(txt) {
        Game.playSound('bear');
        const b = CACHE['speech-bubble'];
        b.innerText = txt; 
        b.style.opacity = 1;
        if(this.msgTimer) clearTimeout(this.msgTimer);
        this.msgTimer = setTimeout(() => { b.style.opacity = 0; }, 3000);
    },
    
    kisses() {
        const k = document.createElement('div');
        k.className = 'kisses-effect';
        k.innerHTML = 'ğŸ’‹â¤ï¸';
        k.style.left = this.x + '%'; k.style.top = this.y + '%';
        CACHE['world'].appendChild(k);
        setTimeout(()=>k.remove(), 1500);
        this.anger = Math.max(0, this.anger - 20);
        this.say("Ø§Ù„Ù…ÙƒØ§Ù† ÙŠÙØªØ­ Ø§Ù„Ù†ÙØ³ âœ¨");
    }
};

const Player = {
    x: 50, y: 50, holding: [],
    move(e) {
        if(Game.mode !== 'normal') return;
        if (e.target.closest('.obj') || e.target.closest('#bear-container') || e.target.closest('.dirt-obj')) return;
        const rect = CACHE['world'].getBoundingClientRect();
        this.goto(((e.clientX - rect.left)/rect.width)*100, ((e.clientY - rect.top)/rect.height)*100);
    },
    goto(x, y, cb) {
        const h = CACHE['heba'];
        if(x > this.x) h.style.transform = "scaleX(-1)"; else h.style.transform = "scaleX(1)";
        this.x = x; this.y = y;
        
        let speed = 0.3;
        if (Game.modifiers['speed1']) speed = 0.24;
        if (Game.modifiers['speed2']) speed = 0.18;
        if (Game.modifiers['speed3']) speed = 0.12;
        if (Game.modifiers['donut']) speed = 0;

        h.style.transition = `top ${speed}s linear, left ${speed}s linear`;
        h.style.left = `calc(${x}% - 25px)`; h.style.top = `calc(${y}% - 25px)`;
        
        if (speed === 0) {
            if(cb) cb();
        } else {
            if(cb) setTimeout(cb, speed * 1000);
        }
    },
    updateInv() {
        const i = document.getElementById('inventory-display');
        i.innerHTML = this.holding.map(x => `<span class="inv-item-bubble">${x}</span>`).join('');
    }
};

const Interact = {
    obj(id, e) {
        e.stopPropagation();
        Game.playSound('click');
        const rect = document.getElementById(id).getBoundingClientRect();
        const w = CACHE['world'].getBoundingClientRect();
        Player.goto(((rect.left + rect.width/2 - w.left)/w.width)*100, ((rect.top + rect.height/2 - w.top)/w.height)*100, () => {
            this.act(id);
        });
    },
    
    act(id) {
        const P = Player;
        const qualityMap = { 'tv': 'ğŸ“º', 'shower': 'ğŸš¿', 'bed': 'ğŸ’¤', 'chair': 'ğŸ’¬' };
        
        let foundOrder = Bear.orders.find(o => o.item === qualityMap[id]);
        if(!foundOrder && id === 'bed') {
             foundOrder = Bear.orders.find(o => o.item === 'ğŸ›ï¸');
        }

        if (foundOrder) {
            if (id === 'bed') {
                 Game.mode = 'sleep';
                 document.getElementById('sleep-game').style.display = 'flex';
                 SleepGame.start(foundOrder.id);
            } else {
                 if(id === 'shower') Game.playSound('water');
                 if(id === 'tv') Game.playSound('tv');
                 const el = document.getElementById(id);
                 const rect = el.getBoundingClientRect();
                 const w = CACHE['world'].getBoundingClientRect();
                 Bear.move(((rect.left-w.left)/w.width)*100, ((rect.top-w.top)/w.height)*100);
                 
                 this.prog(id, 4000, () => {
                     const idx = Bear.orders.indexOf(foundOrder);
                     if(idx > -1) {
                        Bear.completeOrder(idx);
                        Bear.reset();
                     }
                 });
            }
            return;
        }

        if(id === 'fridge') {
            Game.playSound('ice');
            const m = document.getElementById('generic-menu-modal');
            m.classList.add('frost-theme');
            this.showMenu(Object.keys(INGREDIENTS).filter(k => INGREDIENTS[k].u <= Game.level), "Ø§Ù„ØªÙ„Ø§Ø¬Ø© â„ï¸");
        } else if(id === 'snacks-area') {
            this.showMenu(['ğŸ¿','ğŸª','ğŸ«','ğŸ¥¨'], "ØªØ³Ø§Ù„ÙŠ ğŸ¥¨");
        } else if(id === 'sink') {
            WashingGame.start();
        } else if(id === 'cow-station') {
            this.prog(id, 3000, () => { this.addToInv('ğŸ¥›'); });
        } else {
            let baseId = id.replace(/[0-9]/g, '');
            if(RECIPES[P.holding[P.holding.length-1]] && RECIPES[P.holding[P.holding.length-1]].s === baseId) {
                const ing = P.holding.pop(); P.updateInv();
                let time = RECIPES[ing].t;
                if(baseId === 'stove' && Game.modifiers['fast_stove']) time *= 0.5;
                if(baseId === 'prep' && Game.modifiers['fast_prep']) time *= 0.5;
                if(baseId === 'oven' && Game.modifiers['fast_oven']) time *= 0.5;
                if(baseId === 'icecream' && Game.modifiers['fast_ice']) time *= 0.5;
                if(Game.activeChallenge && Game.activeChallenge.machineSlow) time *= Game.activeChallenge.machineSlow;

                this.prog(id, time, () => { this.addToInv(RECIPES[ing].out); });
            } else if(baseId === 'coffee-machine') {
                 Bear.say("Ù„Ø§Ø²Ù… Ø¨Ù† â˜•");
            }
        }
    },

    addToInv(item) {
        let max = 3;
        if(Game.modifiers['cap1']) max = 4;
        if(Game.modifiers['cap2']) max = 5;
        if(Game.modifiers['cap3']) max = 6;
        if(Player.holding.length < max) {
            Player.holding.push(item);
            Player.updateInv();
        }
    },

    showMenu(items, title) {
        Game.playSound('modal');
        CACHE['menu-title'].innerText = title;
        CACHE['shop-tabs'].style.display = 'none';
        CACHE['menu-grid'].innerHTML = items.map(i => `<button class="menu-btn" onclick="Interact.pick('${i}')">${i}</button>`).join('');
        CACHE['menu-footer'].innerHTML = '';
        CACHE['generic-menu-modal'].style.display = 'flex';
    },

    pick(i) {
        Game.playSound('pop');
        this.addToInv(i);
        Game.closeModals();
    },

    prog(id, t, cb) {
        const el = document.getElementById(id);
        const b = el.querySelector('.prog-bar'), f = el.querySelector('.prog-fill');
        let time = Game.modifiers['donut'] ? 0 : t;
        
        if(!b) return cb();
        if(time === 0) return cb();

        let baseId = id.replace(/[0-9]/g, '');
        if (baseId === 'stove' || baseId === 'fryer') Game.playSound('fry');
        else if (baseId === 'prep') Game.playSound('chop');
        else if (baseId === 'sink' || baseId === 'cow-station') Game.playSound('water');
        else Game.playSound('cook');

        b.style.display = 'block'; f.style.width = '0%'; f.style.transition = `width ${time}ms linear`;
        setTimeout(() => f.style.width = '100%', 10);
        setTimeout(() => { 
            b.style.display = 'none'; f.style.width = '0%'; f.style.transition = 'none'; 
            Game.playSound('success');
            cb(); 
        }, time);
    },
    
    clean(dirtEl) {
        const w = CACHE['world'].getBoundingClientRect();
        const r = dirtEl.getBoundingClientRect();
        Player.goto(((r.left-w.left)/w.width)*100, ((r.top-w.top)/w.height)*100, () => {
             Game.playSound('clean');
             let t = 1000;
             if(Game.modifiers['clean1']) t = 500;
             if(Game.modifiers['donut']) t = 0;
             
             if(t > 0) {
                 setTimeout(() => {
                    dirtEl.remove();
                    World.dirt = World.dirt.filter(d => d !== dirtEl);
                    if(World.dirt.length === 0) Bear.kisses();
                 }, t);
             } else {
                 dirtEl.remove();
                 World.dirt = World.dirt.filter(d => d !== dirtEl);
                 if(World.dirt.length === 0) Bear.kisses();
             }
        });
    },

    bear(e) {
        e.stopPropagation();
        Game.playSound('click');
        const r = CACHE['bear-container'].getBoundingClientRect();
        const w = CACHE['world'].getBoundingClientRect();
        Player.goto(((r.left-w.left)/w.width)*100, ((r.top-w.top)/w.height)*100, () => {
            // Check for Drama Order
            const dramaIdx = Bear.orders.findIndex(o => o.item === 'ğŸ­');
            if (dramaIdx > -1) {
                DramaGame.start(dramaIdx);
                return;
            }

            if(Player.holding.length === 0) {
                const kissIdx = Bear.orders.findIndex(o => o.item === 'ğŸ’‹');
                if (kissIdx > -1) {
                    KissingGame.start(kissIdx);
                    return;
                }
                
                CACHE['the-bear'].innerText = 'ğŸ˜';
                Bear.say(TEXT.bear_empty[Math.floor(Math.random()*TEXT.bear_empty.length)]);
                return;
            }

            const orders = [...Bear.orders];
            let actionDone = false;
            
            for(let i=0; i<orders.length; i++) {
                const o = orders[i];
                if(o.type !== 'food') {
                    if(o.item === 'ğŸ’¬') {
                        const el = document.getElementById('chair');
                        const rect = el.getBoundingClientRect();
                        Bear.move(((rect.left-w.left)/w.width)*100, ((rect.top-w.top)/w.height)*100);
                        Interact.prog('chair', 4000, () => {
                             Bear.completeOrder(i);
                             Bear.reset();
                        });
                        actionDone = true; break;
                    }
                }
            }
            if(actionDone) return;

            if(Game.dirtyPlates >= Game.maxPlates) return Bear.say("Ù…ÙÙŠØ´ Ø§Ø·Ø¨Ø§Ù‚ Ù†Ø¶ÙŠÙØ©! ğŸ½ï¸");
            
            let servedCount = 0;
            const toServe = [];

            for(let i=0; i<orders.length; i++) {
                const idx = Player.holding.indexOf(orders[i].item);
                if(idx > -1) {
                    Player.holding.splice(idx, 1);
                    toServe.push(i);
                    break;
                }
            }

            if(toServe.length > 0) {
                Player.updateInv();
                toServe.forEach(i => Bear.completeOrder(i));
                return;
            }

            Bear.say("Ù…Ø´ Ø¯Ù‡ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ ğŸ›‘");
            Game.lives--;
            Game.updateHUD();
            if(Game.lives <= 0) Game.gameOver();
        });
    }
};

const World = {
    rats: [], dirt: [],
    reset() { 
        document.querySelectorAll('.rat').forEach(r => r.remove()); 
        document.querySelectorAll('.dirt-obj').forEach(d => d.remove());
        this.rats = []; this.dirt = [];
    },
    removeRat(r) {
        r.remove();
        this.rats = this.rats.filter(x => x !== r);
    },
    update(dt) {
        let ratChance = (0.0005 * Game.level) / 2;
        if(Game.activeChallenge && Game.activeChallenge.ratRate) ratChance *= Game.activeChallenge.ratRate;
        if(Game.activeChallenge && Game.activeChallenge.allHard) ratChance *= 2;

        if(this.rats.length < 3 && Math.random() < ratChance) {
            const r = document.createElement('div');
            r.className = 'rat'; r.innerText = 'ğŸ€';
            r.style.left = (Math.random()*90 + 5) + '%';
            r.style.top = '-50px';
            r.onclick = (e) => {
                e.stopPropagation();
                
                // Shooting Effect
                Game.playSound('shoot');
                const p = document.getElementById('player-sprite');
                const old = p.innerText;
                p.innerText = 'ğŸ¥ğŸ”«';
                setTimeout(() => p.innerText = old, 500);

                this.removeRat(r);
                Bear.say("ÙØ§Ø± Ù…Ø¹ÙÙ†");
                Game.cash += 5;
            };
            document.getElementById('zone-kitchen').appendChild(r);
            this.rats.push(r);
            setTimeout(() => { r.style.top = (Math.random()*80 + 10) + '%'; }, 100);
        }
        
        let dirtChance = (0.002 * Game.level) / 2;
        if(Game.activeChallenge && Game.activeChallenge.dirtRate) dirtChance *= Game.activeChallenge.dirtRate;
        if(Game.activeChallenge && Game.activeChallenge.allHard) dirtChance *= 2;

        if(this.dirt.length < 5 && Math.random() < dirtChance) {
            const d = document.createElement('div');
            // Dirt Replacement
            const emojis = ['ğŸ§¦', 'ğŸ—‘ï¸', 'ğŸ“„', 'ğŸ§¶'];
            d.className = 'dirt-obj'; d.innerText = emojis[Math.floor(Math.random()*emojis.length)];
            d.style.left = (Math.random()*90 + 5) + '%';
            d.style.top = (Math.random()*90 + 5) + '%';
            d.onclick = (e) => { e.stopPropagation(); Interact.clean(d); };
            document.getElementById('zone-living').appendChild(d);
            this.dirt.push(d);
        }
        
        this.rats.forEach(r => {
            const rx = parseFloat(r.style.left), ry = parseFloat(r.style.top);
            if(ry < 0) return; 
            const dx = Player.x - rx, dy = Player.y - ry;
            const dist = Math.sqrt(dx*dx + dy*dy);
            
            if(dist < 5) {
                if(Player.holding.length > 0) {
                    Player.holding.pop(); Player.updateInv();
                    Bear.say("Ø§Ù„ÙØ§Ø± Ø³Ø±Ù‚ Ø§Ù„Ø§ÙƒÙ„! ÙŠØ§ Ø¹Ø¨Ø¨ÙŠØ·Ù‡");
                    this.removeRat(r);
                    const theft = document.createElement('div');
                    theft.innerText = "âŒğŸ”"; theft.className = "kisses-effect";
                    theft.style.left = Player.x+'%'; theft.style.top = Player.y+'%';
                    CACHE['world'].appendChild(theft);
                    setTimeout(()=>theft.remove(), 1000);
                }
            } else {
                const speed = dt * (3 + Game.level);
                r.style.left = (rx + (dx/dist)*speed) + '%';
                r.style.top = (ry + (dy/dist)*speed) + '%';
                r.style.transform = dx > 0 ? "scaleX(-1)" : "scaleX(1)";
            }
        });
    }
};

const WashingGame = {
    active: false,
    
    start() {
        Game.playSound('water');
        this.active = true;
        document.getElementById('washing-game').style.display = 'flex';
        this.nextPlate();
    },
    
    nextPlate() {
        if(Game.dirtyPlates <= 0) {
            this.finish();
            return;
        }
        this.renderPlate();
    },
    
    renderPlate() {
        const con = document.getElementById('washing-plate-container');
        con.innerHTML = '<div style="font-size:120px; position:absolute; z-index:1;">ğŸ½ï¸</div>';
        for(let i=0; i<5; i++) {
            const p = document.createElement('div');
            p.innerText = 'ğŸ’©';
            p.className = 'wash-poop';
            p.style.zIndex = '2';
            p.style.left = (20 + Math.random() * 60) + '%';
            p.style.top = (20 + Math.random() * 60) + '%';
            p.onclick = (e) => this.clickPoop(e.target);
            con.appendChild(p);
        }
    },
    
    clickPoop(el) {
        Game.playSound('wash');
        el.remove();
        if(document.querySelectorAll('.wash-poop').length === 0) {
            Game.dirtyPlates--;
            Game.updateHUD();
            setTimeout(() => this.nextPlate(), 500);
        }
    },
    
    finish() {
        this.active = false;
        Game.closeModals();
        Bear.say("Ù†Ø¶ÙŠÙ ÙˆØ²ÙŠ Ø§Ù„ÙÙ„ âœ¨");
    }
};

const KissingGame = {
    active: false,
    orderIdx: -1,
    
    start(idx) {
        Game.playSound('modal');
        this.active = true;
        this.orderIdx = idx;
        document.getElementById('kissing-game').style.display = 'flex';
        this.renderGame();
    },
    
    renderGame() {
        const con = document.getElementById('kissing-plate-container');
        con.innerHTML = '<div style="font-size:100px;">ğŸ»</div>';
        for(let i=0; i<5; i++) {
            const p = document.createElement('div');
            p.innerText = 'ğŸ‘ˆ';
            p.className = 'kiss-point';
            p.style.left = (Math.random() * 60 + 20) + '%';
            p.style.top = (Math.random() * 60 + 20) + '%';
            p.onclick = (e) => this.clickPoint(e.target);
            con.appendChild(p);
        }
    },
    
    clickPoint(el) {
        Game.playSound('kiss');
        el.innerText = 'ğŸ’‹';
        el.style.animation = 'floatUp 0.5s forwards';
        setTimeout(() => {
            el.remove();
            if(document.querySelectorAll('.kiss-point').length === 0) {
                this.finish();
            }
        }, 500);
    },
    
    finish() {
        this.active = false;
        Game.closeModals();
        if(this.orderIdx > -1) {
            Bear.completeOrder(this.orderIdx);
            this.orderIdx = -1;
        }
        Bear.anger = 0;
        Bear.updateStats();
        Bear.say("Ø§Ø­Ù„Ù‰ Ø¨ÙˆØ³Ø© ğŸ˜˜");
    }
};

const SleepGame = {
    happiness: 0,
    orderId: -1,
    
    start(oid) {
        Game.playSound('modal');
        this.happiness = 0;
        this.orderId = oid;
        const img = document.getElementById('sleep-img');
        img.src = "https://i.ibb.co/bRLJNFQR/image.png";
        document.getElementById('happy-bar-fill').style.width = '0%';
        document.getElementById('happy-val').innerText = '0';
    },
    
    click(e) {
        Game.playSound('pop');
        const img = document.getElementById('sleep-img');
        img.classList.remove('shake');
        void img.offsetWidth;
        img.classList.add('shake');
        
        // Tongue Logic
        const tongue = document.createElement('div');
        tongue.innerText = 'ğŸ‘…';
        tongue.className = 'tongue-anim';
        tongue.style.left = e.clientX + 'px';
        tongue.style.top = e.clientY + 'px';
        document.getElementById('sleep-game').appendChild(tongue);
        setTimeout(() => tongue.remove(), 500);

        if(this.happiness >= 100) return;
        this.happiness += 5;
        if(this.happiness > 100) this.happiness = 100;
        
        document.getElementById('happy-bar-fill').style.width = this.happiness + '%';
        document.getElementById('happy-val').innerText = Math.floor(this.happiness);
        
        if(this.happiness >= 100) {
            this.finish();
        }
    },

    update(dt) {
        if(this.happiness > 0 && this.happiness < 100) {
            this.happiness -= 10 * dt;
            if(this.happiness < 0) this.happiness = 0;
            document.getElementById('happy-bar-fill').style.width = this.happiness + '%';
            document.getElementById('happy-val').innerText = Math.floor(this.happiness);
        }
    },
    
    finish() {
        // Rain Animation then Close
        for(let i=0; i<50; i++) {
            const d = document.createElement('div');
            d.innerText = 'ğŸ’§';
            d.className = 'rain-drop';
            d.style.left = Math.random() * 100 + '%';
            d.style.animationDuration = (1 + Math.random()) + 's';
            d.style.animationDelay = Math.random() + 's';
            document.getElementById('sleep-game').appendChild(d);
        }
        
        // Fade out
        document.getElementById('sleep-game').style.transition = 'opacity 1s';
        document.getElementById('sleep-game').style.opacity = '0';

        setTimeout(() => {
            document.getElementById('sleep-game').style.transition = 'none';
            document.getElementById('sleep-game').style.opacity = '1';
            document.querySelectorAll('.rain-drop').forEach(r => r.remove());
            
            Game.closeModals();
            const idx = Bear.orders.findIndex(x => x.id === this.orderId);
            if(idx > -1) {
                Bear.completeOrder(idx);
            }
            this.orderId = -1;
            Bear.anger = 0;
            Bear.say("Ø§ÙˆÙÙÙ ÙƒÙ†ØªÙŠ ØªØ­ÙÙ‡");
        }, 2000);
    }
};

const DramaGame = {
    active: false,
    orderIdx: -1,
    
    start(idx) {
        this.active = true;
        this.orderIdx = idx;
        
        // Pick Random State
        const bearState = DRAMA_DATA.bear_states[Math.floor(Math.random() * DRAMA_DATA.bear_states.length)];
        
        // Pick 1 Correct "Cold" Answer
        const correct = DRAMA_DATA.cold_answers[Math.floor(Math.random() * DRAMA_DATA.cold_answers.length)];
        
        // Pick 3 Incorrect "Normal" Answers
        const incorrect = [...DRAMA_DATA.normal_answers].sort(() => 0.5 - Math.random()).slice(0, 3);
        
        const choices = [{txt: correct, valid: true}];
        incorrect.forEach(t => choices.push({txt: t, valid: false}));
        choices.sort(() => 0.5 - Math.random());
        
        this.render(bearState, choices);
        document.getElementById('drama-game').style.display = 'flex';
    },
    
    render(bearState, choices) {
        const view = CACHE['drama-chat-view'];
        
        let buttonsHtml = '';
        choices.forEach(c => {
            // Only cold answer is strictly correct to proceed/win the interaction
            buttonsHtml += `<button class="drama-choice-btn" onclick="DramaGame.select(${c.valid})">${c.txt}</button>`;
        });

        view.innerHTML = `
            <div class="drama-row left">
                <div class="drama-avatar">ğŸ»</div>
                <div class="drama-msg-bubble">${bearState}</div>
            </div>
            <div class="drama-row right">
                <div class="drama-choices-container">
                    ${buttonsHtml}
                </div>
                <div class="drama-avatar">ğŸ¤</div>
            </div>
        `;
    },
    
    select(isValid) {
        if(isValid) {
            Game.playSound('success');
            Bear.anger = Math.max(0, Bear.anger - 25);
            if(this.orderIdx > -1) Bear.completeOrder(this.orderIdx);
            Bear.say("Ø®Ù„Ø§Øµ Ù…Ø§Ø´ÙŠ ğŸ˜’");
        } else {
            Game.playSound('bear');
            Bear.anger += 20;
            Game.lives--;
            Bear.say("Ù…Ø´ Ø¯ÙŠ Ø§Ù„Ø¯Ø±Ø§Ù…Ø§ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©! ğŸ˜¡");
            Game.updateHUD();
            if(Game.lives <= 0) Game.gameOver();
        }
        
        this.active = false;
        Game.closeModals();
    }
};

const GiftSystem = {
    active: false,
    clicks: 0,
    reqClicks: 5,
    
    open() {
        this.active = true;
        this.clicks = 0;
        document.getElementById('level-complete-modal').style.display = 'none';
        document.getElementById('gift-modal').style.display = 'flex';
        document.getElementById('gift-msg').innerText = "Ø§Ø¶ØºØ·ÙŠ Ø¨Ø³Ø±Ø¹Ø© Ø¹Ø´Ø§Ù† ØªÙØªØ­ÙŠ! ğŸ";
        const box = document.getElementById('gift-box-anim');
        box.innerText = "ğŸ";
        box.style.pointerEvents = 'auto';
        document.getElementById('gift-cont-btn').style.display = 'none';
    },

    click() {
        if(!this.active) return;
        
        const box = document.getElementById('gift-box-anim');
        box.classList.remove('gift-bounce');
        void box.offsetWidth;
        box.classList.add('gift-bounce');
        
        Game.playSound('pop');
        this.spawnText();
        
        this.clicks++;
        if(this.clicks >= this.reqClicks) {
            this.reveal();
        }
    },

    spawnText() {
        const msgs = ["ÙŠØ§Ù„Ù„Ù‡!", "ÙƒÙ…Ø§Ù†!", "Ø´Ø·ÙˆØ±Ø©!", "â¤ï¸", "ğŸ˜", "ğŸ”¥"];
        const colors = ["#FF4081", "#FFEB3B", "#00E676", "#2979FF", "#D500F9"];
        const txt = msgs[Math.floor(Math.random()*msgs.length)];
        const el = document.createElement('div');
        el.className = 'gift-float-text';
        el.innerText = txt;
        el.style.color = colors[Math.floor(Math.random()*colors.length)];
        el.style.left = (50 + (Math.random()*40 - 20)) + '%';
        el.style.top = (50 + (Math.random()*40 - 20)) + '%';
        document.getElementById('gift-modal').appendChild(el);
        setTimeout(() => el.remove(), 1000);
    },

    reveal() {
        this.active = false;
        Game.playSound('success');
        confetti({ particleCount: 150, spread: 100, origin: { y: 0.6 } });
        
        const box = document.getElementById('gift-box-anim');
        box.innerText = "ğŸŠ";
        box.style.pointerEvents = 'none';
        
        const isReal = Math.random() < 0.3; // 30% Chance for real gift
        if(isReal) {
            const keys = Object.keys(GIFTS);
            const key = keys[Math.floor(Math.random()*keys.length)];
            const link = GIFTS[key];
            document.getElementById('gift-msg').innerHTML = `Ù…Ø¨Ø±ÙˆÙƒ! <a href="${link}" target="_blank" style="color:yellow; text-decoration:underline;">Ø¯ÙˆØ³ Ù‡Ù†Ø§ Ù„Ù„Ù‡Ø¯ÙŠØ©</a>`;
        } else {
            const msg = FALSE_GIFTS[Math.floor(Math.random()*FALSE_GIFTS.length)];
            document.getElementById('gift-msg').innerText = msg;
        }
        
        document.getElementById('gift-cont-btn').style.display = 'block';
    }
};
</script>
</body>
</html>